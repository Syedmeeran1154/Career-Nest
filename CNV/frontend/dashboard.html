<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <title>Career Nest - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root{
            --brand-color: #6366f1;
            --brand-dark: #4338ca;
            /* Default Light Theme Variables - Used by ThemeManager originally, now hardcoded */
            --theme-primary: #6366f1;
            --theme-secondary: #4338ca;
            --theme-background: #f8fafc;
            --theme-surface: #ffffff;
            --theme-text: #1e293b;
            --theme-textSecondary: #64748b;
            --theme-border: #e2e8f0;
            --theme-cardBg: #ffffff;
            --theme-sidebarBg: linear-gradient(180deg, #4338ca, #6366f1);
            --theme-accent: #10b981;
        }
        body{
            font-family: 'Inter', sans-serif;
            background-color: var(--theme-background); /* Use variable for clarity */
            color: var(--theme-text);
            transition: all 0.3s ease;
        }
        .brand-title{
            font-family: 'Poppins', sans-serif;
        }
        .sidebar-bg{
            background: var(--theme-sidebarBg);
            transition: background 0.3s ease, transform 0.3s ease;
        }
        .nav-link.active{
            background-color: rgba(255, 255, 255, 0.2);
            position: relative;
        }
        .nav-link.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background-color: white;
            border-top-right-radius: 9999px;
            border-bottom-right-radius: 9999px;
        }
        .resume-h{
            border-bottom: 2px solid var(--brand-color);
        }
        /* Modern Action Buttons */
.btn-action {
    display: inline-flex;
    align-items: center;
    padding: 0.6rem 1.2rem;
    border-radius: 9999px;
    font-weight: 600;
    font-size: 0.85rem;
    color: white;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.btn-profile {
    background: linear-gradient(135deg, #6366f1 0%, #4338ca 100%);
}

.btn-ai {
    background: linear-gradient(135deg, #a855f7 0%, #7e22ce 100%);
}

.btn-action:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
    filter: brightness(1.1);
}

.btn-action:active {
    transform: translateY(0);
}

/* Mobile Adjustments */
@media (max-width: 640px) {
    .btn-action {
        width: 100%; /* Full width on mobile for better touch target */
        justify-content: center;
        padding: 0.75rem 1rem;
    }
}
        .skill-progress-bar div{
            background: linear-gradient(90deg, #6366f1, #3b82f6);
            position: relative;
        }
        /* Animated stripes for progress bar */
        .skill-progress-bar div::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(
                -45deg,
                rgba(255, 255, 255, 0.2) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0.2) 75%,
                transparent 75%,
                transparent
            );
            background-size: 1rem 1rem;
            animation: animate-stripes 2s linear infinite;
        }
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }
        .resume-photo-upload {
    border: 2px dashed #e2e8f0;
    border-radius: 0.5rem;
    padding: 2.5rem;
    cursor: pointer;
    text-align: center;
    transition: all 0.2s ease-in-out;

    /* FIX ALIGNMENT */
    display: flex;
    flex-direction: column;
    justify-content: center; 
    align-items: center;
}

        .resume-photo-upload:hover {
            background-color: #f1f5f9;
            border-color: #94a3b8;
        }
        .resume-photo-preview {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 50%;
            border: 4px solid var(--brand-color);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        /* Corrected: Replaced @apply rules with raw CSS / removed the non-working utility classes */
        .input {
            width: 100%; 
            padding: 0.5rem 1rem; /* px-4 py-2 */
            border: 1px solid #d1d5db; /* border border-gray-300 */
            border-radius: 0.5rem; /* rounded-lg */
            outline: none; /* outline-none */
            transition: all 0.3s ease-in-out; /* transition-all duration-300 */
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); /* shadow-sm */
        }
        .input:focus {
            --tw-ring-color: #6366f1; /* focus:ring-indigo-500 */
            --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
            --tw-ring-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow);
            box-shadow: var(--tw-ring-shadow), 0 1px 2px 0 rgb(0 0 0 / 0.05);
            border-color: transparent; /* focus:border-transparent */
        }
        .btn {
            font-weight: 600; /* font-semibold */
            padding: 0.5rem 1rem; /* py-2 px-4 */
            border-radius: 0.5rem; /* rounded-lg */
            transition: all 0.2s ease-in-out; /* transition-all duration-200 */
        }
        .btn.primary {
            background-color: #4f46e5; /* bg-indigo-600 */
            color: white; /* text-white */
        }
        .btn.primary:hover {
            background-color: #4338ca; /* hover:bg-indigo-700 */
        }
        
        /* Enhanced animations and effects */
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .hover-lift {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
            50% { box-shadow: 0 0 30px rgba(99, 102, 241, 0.6); }
        }
        @keyframes animate-stripes {
            0% { background-position: 0 0; }
            100% { background-position: 1rem 0; }
        }
        .section-handle {
            cursor: grab;
        }
        .section-handle:active {
            cursor: grabbing;
        }

        /* New button styles based on your image */
        .btn-custom {
            font-weight: 600; /* semibold */
            padding: 0.5rem 1.5rem; /* py-2 px-6 */
            border-radius: 9999px; /* rounded-full */
            transition: all 0.2s ease-in-out;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.5);
            color: white;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-custom:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }

        .btn-custom:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        /* Gradient color classes */
        .btn-pink { background: linear-gradient(180deg, #ff80a5, #e02b70); }
        .btn-blue { background: linear-gradient(180deg, #80d9ff, #2b70e0); }
        .btn-green { background: linear-gradient(180deg, #99ff99, #48c948); }
        .btn-orange { background: linear-gradient(180deg, #ffc980, #e0702b); }
        .btn-red { background: linear-gradient(180deg, #ff8080, #e02b2b); }
        .btn-purple { background: linear-gradient(180deg, #d380ff, #9a2be0); }

        /* Dark mode styles (REMOVED) */

        @media (max-width: 768px) {
    /* This fixes the "ugly" overflowing resume on mobile */
    .resume-preview { 
        transform: scale(0.65); 
        transform-origin: top center;
        width: 153.8% !important; 
        margin-bottom: -250px; 
        overflow: hidden; /* Prevents unwanted scrollbars */
    }
    /* This makes your dashboard buttons smaller and neater as requested */
    .btn-custom { 
        padding: 0.5rem 1rem !important; 
        font-size: 0.8rem !important; 
        width: auto !important; /* Prevents buttons from being too wide */
    }
    /* Reduces the massive starting section height */
    #home .bg-gradient-to-r {
        padding: 1.25rem !important;
    }
}

        /* --- Mobile/Responsive Overrides --- */
        /* Sidebar on mobile */
        @media (max-width: 1023px) {
            .sidebar-bg {
                transform: translateX(-100%);
                position: absolute; /* Change to absolute to avoid breaking flow on desktop if toggle is used */
                z-index: 50;
            }
            .sidebar-bg.open {
                transform: translateX(0);
                z-index: 100;
                box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            }
            .main {
                margin-left: 0 !important; /* Remove desktop margin */
                padding-top: 5rem; /* Add space for header/toggle */
            }
        }

        /* Sidebar on desktop (to re-enable fixed view after mobile rules) */
        @media (min-width: 1024px) {
            .sidebar-bg {
                transform: translateX(0) !important;
                position: fixed;
            }
            .main {
                margin-left: 16rem !important; /* Re-enable ml-64 */
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-slate-800 transition-all duration-300">
    <div class="app flex min-h-screen">
        
        <button id="menuToggle" class="lg:hidden fixed top-4 left-4 z-50 p-3 rounded-full bg-indigo-600 text-white shadow-lg transition-all duration-300 hover:scale-110">
            <i class="fas fa-bars text-xl"></i>
        </button>

        <aside class="sidebar-bg w-64 p-6 text-white flex flex-col justify-between rounded-r-2xl shadow-xl transition-all duration-300 fixed top-0 left-0 h-screen overflow-y-auto z-50">
            <div>
                <div class="brand flex items-center gap-2 mb-2">
                    <div class="logo w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center text-2xl">
                        üìÅ
                    </div>
                    <div class="brand-title text-xl font-bold">Career Nest</div>
                </div>
                <p class="text-xs text-white/70 mb-6">Your Professional Journey</p>

                <div class="p-4 bg-white/10 rounded-lg backdrop-blur-sm hover:bg-white/20 transition-all duration-200">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-sm"></i>
                        </div>
                        <div>
                            <div id="userNameDisplay" class="font-semibold text-sm"></div>
                            <div class="text-xs opacity-75">Welcome back!</div>
                        </div>
                    </div>
                </div>

                <nav class="mt-8 flex flex-col space-y-2">
                    <a href="#home" class="nav-link flex items-center gap-2 p-3 rounded-lg hover:bg-white/20 transition-all duration-200 hover:scale-105" data-target="home">
                        <i class="fas fa-home text-lg"></i> Home
                    </a>
                    <a href="#analytics" class="nav-link flex items-center gap-2 p-3 rounded-lg hover:bg-white/20 transition-all duration-200 hover:scale-105" data-target="analytics">
                        <i class="fas fa-chart-line text-lg"></i> Analytics
                    </a>
                    <a href="#achievements" class="nav-link flex items-center gap-2 p-3 rounded-lg hover:bg-white/20 transition-all duration-200 hover:scale-105" data-target="achievements">
                        <i class="fas fa-medal text-lg"></i> Achievements
                    </a>
                    <a href="#profile" class="nav-link flex items-center gap-2 p-3 rounded-lg hover:bg-white/20 transition-all duration-200 hover:scale-105" data-target="profile">
                        <i class="fas fa-user-circle text-lg"></i> Profile <span class="text-xs opacity-75"></span>
                    </a>
                    
                    <h3 class="text-xs uppercase font-bold mt-4 mb-2 text-white/50 pt-2 border-t border-white/20">AI Tools</h3>
                    <a href="#career-coach" class="nav-link flex items-center gap-2 p-3 rounded-lg hover:bg-white/20 transition-all duration-200 hover:scale-105" data-target="career-coach">
                        <i class="fas fa-robot text-lg"></i> AI Career Coach
                    </a>
                    <a href="#resume-scorer" class="nav-link flex items-center gap-2 p-3 rounded-lg hover:bg-white/20 transition-all duration-200 hover:scale-105" data-target="resume-scorer">
                        <i class="fas fa-bullseye text-lg"></i> Resume Scorer
                    </a>
                    <a href="#jd-matcher" class="nav-link flex items-center gap-2 p-3 rounded-lg hover:bg-white/20 transition-all duration-200 hover:scale-105" data-target="jd-matcher">
                        <i class="fas fa-clipboard-check text-lg"></i> JD Matcher
                    </a>
                    <a href="#interview-prep"
   class="nav-link flex items-center gap-2 p-3 rounded-lg hover:bg-white/20 transition-all duration-200 hover:scale-105"
   data-target="interview-prep">
  <i class="fas fa-microphone-alt text-lg"></i> Interview Prep
</a>
                    <h3 class="text-xs uppercase font-bold mt-4 mb-2 text-white/50 pt-2 border-t border-white/20">Resume Actions</h3>
                    <a href="#resume" class="nav-link flex items-center gap-2 p-3 rounded-lg hover:bg-white/20 transition-all duration-200 hover:scale-105" data-target="resume">
                        <i class="fas fa-file-alt text-lg"></i> Resume Builder
                    </a>
     

                    
                    </nav>
            </div>
            <br/>
            <div>
                <button id="exportBtn" class="btn-custom btn-orange w-full">
                    <i class="fas fa-download"></i>Export Resume
                </button>
                <button id="logoutBtn" class="btn-custom btn-red w-full mt-3">
                    <i class="fas fa-sign-out-alt"></i>Logout
                </button>
                <p class="text-xs text-white/70 mt-2">Data synced to your account</p>
            </div>
        </aside>

        <main class="main flex-1 p-8 overflow-auto custom-scroll transition-all duration-300 lg:ml-64">
            <div class="page max-w-5xl mx-auto">
                <section id="home" class="hidden fade-in">
                   <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-5 md:p-8 rounded-2xl shadow-lg mb-6">
    <div class="flex flex-col lg:flex-row items-start lg:items-center gap-4">
        <div class="flex-1">
            <h1 class="text-2xl md:text-4xl font-extrabold brand-title">Welcome back, <span id="welcomeName">User</span>! üëã</h1>
            <p class="text-sm md:text-lg opacity-90">Your professional journey at a glance.</p>
        </div>
        <div class="flex flex-wrap gap-3 mt-4">
    <button onclick="navigate('profile')" class="btn-action btn-profile">
        <i class="fas fa-user-edit mr-2"></i>Update Profile
    </button>
    <button onclick="navigate('career-coach')" class="btn-action btn-ai">
        <i class="fas fa-robot mr-2"></i>Explore AI
    </button>
</div>
    </div>
</div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div id="statusProfileCompletion" class="p-4 rounded-xl text-white bg-indigo-600 shadow-lg flex items-center justify-between hover-lift transition-all duration-300">
                            <div class="flex flex-col text-left">
                                <div id="profileCompletionScore" class="text-3xl font-extrabold">‚Äî%</div>
                                <div class="mt-1 text-sm font-semibold">Profile Completion</div>
                            </div>
                            <i class="fas fa-user-check text-4xl opacity-70"></i>
                        </div>

                        <div id="statusATSScore" class="p-4 rounded-xl text-white bg-red-600 shadow-lg flex items-center justify-between hover-lift transition-all duration-300">
                            <div class="flex flex-col text-left">
                                <div id="atsScoreDisplay" class="text-3xl font-extrabold">‚Äî%</div>
                                <div class="mt-1 text-sm font-semibold">ATS Resume Score</div>
                            </div>
                            <i class="fas fa-bullseye text-4xl opacity-70"></i>
                        </div>

                        <div id="statusCareerPlan" class="p-4 rounded-xl text-white bg-purple-600 shadow-lg flex items-center justify-between hover-lift transition-all duration-300">
                            <div class="flex flex-col text-left max-w-[80%]">
                                <div id="careerGoalDisplay" class="text-lg font-extrabold truncate">‚Äî</div>
                                <div class="mt-1 text-sm font-semibold">Career Plan Goal</div>
                            </div>
                            <i class="fas fa-user-tie text-4xl opacity-70"></i>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg mb-8 hover-lift transition-all duration-300">
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                            <i class="fas fa-trophy text-yellow-500"></i>Recent Achievements
                        </h2>
                        <div id="recentAchievements" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                    </div>

                    <div class="flex flex-col lg:flex-row items-start lg:items-center gap-6 mb-8">
                        <div class="flex-1">
                            <h2 class="text-3xl font-extrabold brand-title text-indigo-700">Your Professional Hub</h2>
                            <p class="text-lg text-slate-500 mt-2">Track your journey, showcase your skills, and level up your career.</p>
                            <div class="flex gap-3 mt-4">
                                <button id="loadSample" class="btn-custom btn-green">
                                    <i class="fas fa-magic"></i>Load Demo Data
                                </button>
                                <button onclick="navigate('analytics')" class="btn-custom btn-purple">
                                    <i class="fas fa-chart-line"></i>View Analytics
                                </button>
                            </div>
                        </div>
                        <div id="snapshot" class="bg-white p-6 rounded-xl shadow-lg w-full lg:w-72 flex items-center gap-4 hover-lift transition-all duration-300">
                            <img id="snapPhoto" class="w-16 h-16 rounded-full object-cover hidden" alt="Profile Photo">
                            <div class="flex-1">
                                <h4 class="text-lg font-bold text-gray-700 mb-2">Your Snapshot</h4>
                                <p class="text-sm"><strong class="font-semibold">Name:</strong> <span id="snapName" class="text-slate-500">‚Äî</span></p>
                                <p class="text-sm"><strong class="font-semibold">Level:</strong> <span id="snapLevel" class="text-slate-500">‚Äî</span></p>
                                <p class="text-sm"><strong class="font-semibold">Top Skill:</strong> <span id="snapSkill" class="text-slate-500">‚Äî</span></p>
                                <p class="text-sm"><strong class="font-semibold">Projects:</strong> <span id="snapProjCount" class="text-slate-500">0</span></p>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="p-6 rounded-xl shadow-lg text-white bg-gradient-to-br from-indigo-500 to-indigo-700 hover-lift transition-all duration-300">
                            <div id="projectCount" class="text-4xl font-extrabold">0</div>
                            <div class="mt-2 text-sm font-semibold">Projects</div>
                        </div>
                        <div class="p-6 rounded-xl shadow-lg text-white bg-gradient-to-br from-sky-500 to-blue-600 hover-lift transition-all duration-300">
                            <div id="skillCount" class="text-4xl font-extrabold">0</div>
                            <div class="mt-2 text-sm font-semibold">Skills</div>
                        </div>
                        <div class="p-6 rounded-xl shadow-lg text-white bg-gradient-to-br from-emerald-500 to-green-600 hover-lift transition-all duration-300">
                            <div id="certCount" class="text-4xl font-extrabold">0</div>
                            <div class="mt-2 text-sm font-semibold">Certificates</div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300">
                            <h3 class="text-lg font-bold flex items-center gap-2">
                                <i class="fas fa-folder-open text-indigo-600"></i>Recent Projects
                            </h3>
                            <ul id="projectList" class="mt-4 space-y-2 text-sm"></ul>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300">
                            <h3 class="text-lg font-bold flex items-center gap-2">
                                <i class="fas fa-tools text-sky-600"></i>Top Skills
                            </h3>
                            <div id="skillsContainer" class="mt-4 flex flex-col gap-2"></div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300">
                            <h3 class="text-lg font-bold flex items-center gap-2">
                                <i class="fas fa-certificate text-emerald-600"></i>Certificates
                            </h3>
                            <div id="certContainer" class="mt-4 grid grid-cols-1 gap-2"></div>
                        </div>
                    </div>
                </section>

                <section id="analytics" class="hidden fade-in">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold brand-title text-indigo-700 mb-2">Career Analytics</h2>
                        <p class="text-lg text-slate-500">Visualize your skills and track your professional growth</p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300">
                            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                                <i class="fas fa-chart-pie text-indigo-600"></i>Skill Distribution
                            </h3>
                            <div id="skillRadarChart" class="flex justify-center mb-4"></div>
                            <div id="skillBreakdown" class="mt-4 space-y-2"></div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300">
                            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                                <i class="fas fa-chart-line text-green-600"></i>Growth Timeline
                            </h3>
                            <div id="progressTimeline" class="space-y-4"></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300">
                            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                                <i class="fas fa-chart-bar text-blue-600"></i>Skills Progress
                            </h3>
                            <div id="skillsBarChart" class="w-full h-64"></div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300">
                            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                                <i class="fas fa-chart-line text-purple-600"></i>Progress Over Time
                            </h3>
                            <div id="progressLineChart" class="w-full h-64"></div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300 mb-8">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                            <i class="fas fa-chart-pie text-orange-600"></i>Achievement Distribution
                        </h3>
                        <div id="achievementPieChart" class="w-full h-80"></div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300">
                            <h4 class="font-semibold text-gray-700 mb-3">Skill Categories</h4>
                            <div id="skillCategories" class="space-y-2"></div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300">
                            <h4 class="font-semibold text-gray-700 mb-3">Project Technologies</h4>
                            <div id="projectTechnologies" class="space-y-2"></div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300">
                            <h4 class="font-semibold text-gray-700 mb-3">Achievement Summary</h4>
                            <div id="achievementSummary" class="space-y-2"></div>
                        </div>
                    </div>
                </section>

                <section id="achievements" class="hidden fade-in">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold brand-title text-indigo-700 mb-2">Achievements & Badges</h2>
                        <p class="text-lg text-slate-500">Track your progress and celebrate your milestones</p>
                    </div>

                    <div id="levelProgress" class="mb-8"></div>

                    <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                            <i class="fas fa-medal text-yellow-500"></i>Earned Badges
                        </h3>
                        <div id="badgesContainer"></div>
                    </div>
                </section>

                <section id="profile" class="hidden fade-in">
                    <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300 mb-8">
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                            <i class="fas fa-user text-indigo-600"></i>1. Core Profile Information
                        </h2>
                        <form id="profileForm" class="flex flex-col gap-4">
                            <label for="photoUpload" class="resume-photo-upload">
                                <input type="file" id="photoUpload" accept="image/*" class="hidden">
                                <div class="flex flex-col items-center justify-center">
                                    <img id="photoPreview" class="resume-photo-preview mb-2 hidden" alt="Profile Photo Preview">
                                    <span id="photoPlaceholder" class="text-gray-400">
                                        <i class="fas fa-camera text-2xl mb-2"></i><br>
                                        Click to add a profile photo
                                    </span>
                                </div>
                            </label>
                            <input id="name" type="text" placeholder="Full name" class="input" />
                            <input id="email" type="email" placeholder="Email" class="input" />
                            <input id="phone" type="tel" placeholder="Phone number" class="input" />
                            <textarea id="bio" placeholder="Professional summary (2-3 lines)" class="input h-24 resize-none"></textarea>
                            <div class="flex gap-2">
                                <button class="btn-custom btn-blue" type="submit">
                                    <i class="fas fa-save"></i>Save Profile
                                </button>
                                <button id="clearProfile" type="button" class="btn-custom btn-red">
                                    <i class="fas fa-trash"></i>Clear Profile
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300 mb-8">
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                            <i class="fas fa-tools text-indigo-600"></i>2. Skills & Expertise
                        </h2 >
                        <form id="skillsForm" class="flex flex-col gap-4 mb-6">
                            <input id="skillName" type="text" placeholder="Skill name (e.g., JavaScript, Python)" class="input" required />
                            <div class="flex items-center gap-4">
                                <label class="text-sm text-slate-500 flex-1">
                                    Proficiency Level:
                                    <input id="skillLevel" type="range" min="0" max="100" value="75" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mt-2" />
                                </label>
                                <span id="skillLevelVal" class="w-12 text-sm font-semibold bg-indigo-100 px-2 py-1 rounded">75%</span>
                            </div>
                            <div class="flex gap-2">
                                <button class="btn-custom btn-blue" type="submit">
                                    <i class="fas fa-plus"></i>Add Skill
                                </button>
                                <button id="clearSkills" type="button" class="btn-custom btn-red">
                                    <i class="fas fa-trash"></i>Clear All Skills
                                </button>
                            </div>
                        </form>
                        <h3 class="text-xl font-bold mb-4 text-gray-700 border-b pb-2">Your Skills List</h3>
                        <div id="skillsList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300 mb-8">
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                            <i class="fas fa-folder-open text-indigo-600"></i>3. Projects Portfolio
                        </h2>
                        <form id="projectsForm" class="flex flex-col gap-4 mb-6">
                            <input id="projectTitle" type="text" placeholder="Project title" class="input" required />
                            <input id="projectLink" type="url" placeholder="Project link (GitHub, live demo, etc.)" class="input" />
                            <textarea id="projectDesc" placeholder="Brief description of the project and technologies used" class="input h-20 resize-none"></textarea>
                            <div class="flex gap-2">
                                <button class="btn-custom btn-blue" type="submit">
                                    <i class="fas fa-plus"></i>Add Project
                                </button>
                                <button id="clearProjects" type="button" class="btn-custom btn-red">
                                    <i class="fas fa-trash"></i>Clear All Projects
                                </button>
                            </div>
                        </form>
                        <h3 class="text-xl font-bold mb-4 text-gray-700 border-b pb-2">Your Projects List</h3>
                        <div id="projectsList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300 mb-8">
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                            <i class="fas fa-briefcase text-indigo-600"></i>4. Work Experience & Internships
                        </h2>
                        <form id="internForm" class="flex flex-col gap-4 mb-6">
                            <input id="internCompany" type="text" placeholder="Company name" class="input" required />
                            <input id="internRole" type="text" placeholder="Role/Position (e.g., Software Developer Intern)" class="input" required />
                            <input id="internDuration" type="text" placeholder="Duration (e.g., Jan 2024 ‚Äì Jun 2024)" class="input" />
                            <textarea id="internDesc" placeholder="Key responsibilities and achievements" class="input h-20 resize-none"></textarea>
                            <div class="flex gap-2">
                                <button class="btn-custom btn-blue" type="submit">
                                    <i class="fas fa-plus"></i>Add Experience
                                </button>
                                <button id="clearInterns" type="button" class="btn-custom btn-red">
                                    <i class="fas fa-trash"></i>Clear All Experience
                                </button>
                            </div>
                        </form>
                        <h3 class="text-xl font-bold mb-4 text-gray-700 border-b pb-2">Your Experience List</h3>
                        <div id="internsList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300 mb-8">
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                            <i class="fas fa-certificate text-indigo-600"></i>5. Certifications & Achievements
                        </h2>
                        <form id="certForm" class="flex flex-col gap-4 mb-6">
                            <input id="certName" type="text" placeholder="Certificate title" class="input" required />
                            <input id="certIssuer" type="text" placeholder="Issuing organization (e.g., Google, Microsoft, Coursera)" class="input" />
                            <input id="certLink" type="url" placeholder="Certificate link or verification URL" class="input" />
                            <div class="flex gap-2">
                                <button class="btn-custom btn-blue" type="submit">
                                    <i class="fas fa-plus"></i>Add Certificate
                                </button>
                                <button id="clearCerts" type="button" class="btn-custom btn-red">
                                    <i class="fas fa-trash"></i>Clear All Certificates
                                </button>
                            </div>
                        </form>
                        <h3 class="text-xl font-bold mb-4 text-gray-700 border-b pb-2">Your Certificates List</h3>
                        <div id="certsList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300 mb-8">
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                            <i class="fas fa-graduation-cap text-indigo-600"></i>6. Education Background
                        </h2>
                        <form id="eduForm" class="flex flex-col gap-4 mb-6">
                            <input id="eduInstitute" type="text" placeholder="Institution name" class="input" required />
                            <input id="eduDegree" type="text" placeholder="Degree/Program (e.g., B.Sc Computer Science)" class="input" required />
                            <input id="eduYear" type="text" placeholder="Year or duration (e.g., 2020-2024)" class="input" />
                            <div class="flex gap-2">
                                <button class="btn-custom btn-blue" type="submit">
                                    <i class="fas fa-plus"></i>Add Education
                                </button>
                                <button id="clearEdu" type="button" class="btn-custom btn-red">
                                    <i class="fas fa-trash"></i>Clear All Education
                                </button>
                            </div>
                        </form>
                        <h3 class="text-xl font-bold mb-4 text-gray-700 border-b pb-2">Your Education List</h3>
                        <div id="eduList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300 mb-8">
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                            <i class="fas fa-share-alt text-indigo-600"></i>7. Social Media & Links
                        </h2>
                        

                        <form id="socialForm" class="flex flex-col gap-4 mb-6">
                            <input id="socialPlatform" type="text" placeholder="Platform (e.g., LinkedIn, GitHub, Portfolio)" class="input" required />
                            <input id="socialLink" type="url" placeholder="Profile URL" class="input" required />
                            <div class="flex gap-2">
                                <button class="btn-custom btn-blue" type="submit">
                                    <i class="fas fa-plus"></i>Add Link
                                </button>
                                <button id="clearSocial" type="button" class="btn-custom btn-red">
                                    <i class="fas fa-trash"></i>Clear All Links
                                </button>
                            </div>
                        </form>
                        <h3 class="text-xl font-bold mb-4 text-gray-700 border-b pb-2">Your Social Links List</h3>
                        <div id="socialList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </div>
                </section>
                
                <section id="career-coach" class="hidden fade-in">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold brand-title text-indigo-700 mb-2">ü§ñ AI Career Coach & Roadmap Generator</h2>
                        <p class="text-lg text-slate-500">Define your future to generate a personalized, actionable career development plan.</p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300 lg:col-span-1">
                            <h3 class="text-xl font-bold mb-4 text-gray-700">Your Career Trajectory</h3>
                            <form id="coachForm" class="flex flex-col gap-4">
                                <input id="currentRole" type="text" placeholder="Current Role (e.g., Junior Developer)" class="input" required />
                                <input id="targetRole" type="text" placeholder="Target Role (e.g., Senior Software Architect)" class="input" required />
                                <input id="experienceYears" type="number" min="0" placeholder="Years of Experience" class="input" required />
                                <textarea id="coachSkills" placeholder="Current Key Skills (e.g., Python, AWS, SQL) - Separate with comma" class="input h-16 resize-none" required></textarea>
                                <textarea id="careerGoals" placeholder="Specific Career Goals (e.g., Lead a project team, get PMP cert)" class="input h-16 resize-none" required></textarea>
                                <input id="timeline" type="text" placeholder="Target Timeline (e.g., 2 years, 3-5 years)" class="input" required />

                                <button type="submit" class="btn-custom btn-purple mt-4" id="generateRoadmapBtn">
                                    <i class="fas fa-route"></i> Generate Personalized Roadmap
                                </button>
                            </form>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300 lg:col-span-2">
                            <h3 class="text-xl font-bold mb-4 flex items-center gap-2 text-indigo-700">
                                <i class="fas fa-map-marked-alt"></i> Generated Career Roadmap
                            </h3>
                            <div id="roadmapOutput" class="space-y-6">
                                <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200 text-sm text-slate-600">
                                    <i class="fas fa-info-circle mr-1 text-indigo-500"></i>
                                    Fill out the form on the left and click 'Generate Personalized Roadmap' to see your plan here.
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="resume-scorer" class="hidden fade-in">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold brand-title text-indigo-700 mb-2">üéØ Professional Resume Scorer</h2>
                        <p class="text-lg text-slate-500">Analyze your resume against Applicant Tracking Systems (ATS) to maximize your chances of success.</p>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300 mb-8">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                            <i class="fas fa-upload text-blue-600"></i> Upload Your Resume (PDF, DOCX)
                        </h3>
                        <label for="resumeUpload" class="resume-photo-upload border-blue-400 hover:bg-blue-50">
                            <input type="file" id="resumeUpload" accept=".pdf,.docx" class="hidden" required>
                            <div class="flex flex-col items-center justify-center">
                                <i class="fas fa-file-upload text-3xl mb-2 text-blue-500"></i><br>
                                <span class="text-gray-600 font-semibold">Click to upload your resume file</span>
                                <span id="fileNameDisplay" class="text-sm text-slate-500 mt-1">No file selected</span>
                            </div>
                        </label>
                        </br>
                  
                        <button type="button" id="scoreResumeBtn" class="btn-custom btn-blue w-full mt-4" disabled>
                            <i class="fas fa-check-circle"></i> Analyze & Get ATS Score
                        </button>
                    </div>

                    <div id="scorerResults" class="hidden bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300">
                        <h3 class="text-2xl font-bold mb-6 text-green-700 flex items-center gap-2 border-b pb-2">
                            <i class="fas fa-star-half-alt"></i> ATS Score Report
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <div class="p-4 rounded-xl text-white bg-green-500 text-center">
                            <div id="atsCategory" class="text-xl font-bold mb-1"></div> <div id="atsScore" class="text-5xl font-extrabold">‚Äî</div>
                            <div class="text-sm font-semibold mt-1">ATS Compatibility Score</div>
                        </div>
                            <div class="p-4 rounded-xl text-gray-800 bg-yellow-100 text-center md:col-span-2">
                                <h4 class="font-bold text-lg mb-2">Profile Summary</h4> <p id="improvementSummary" class="text-sm text-slate-600">
                                    Your score is high, but the date format in your experience section could be more consistent.
                                </p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="p-4 bg-gray-50 rounded-lg">
                                <h4 class="font-bold text-lg mb-3 flex items-center gap-2 text-gray-700"><i class="fas fa-chart-bar"></i> Detailed Analysis</h4>
                                <ul id="detailedAnalysisList" class="list-disc list-inside space-y-2 text-sm text-slate-600">
                                    </ul>
                            </div>
                            <div class="p-4 bg-gray-50 rounded-lg">
                                <h4 class="font-bold text-lg mb-3 flex items-center gap-2 text-gray-700"><i class="fas fa-tags"></i> Keyword Check</h4>
                                <div class="mb-4">
                                    <p class="font-semibold text-sm">Keywords Found (6/8)</p>
                                    <div id="keywordsFound" class="flex flex-wrap gap-2 mt-1">
                                        </div>
                                </div>
                                <div>
                                    <p class="font-semibold text-sm text-red-600">Missing Keywords (2)</p>
                                    <div id="keywordsMissing" class="flex flex-wrap gap-2 mt-1">
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="jd-matcher" class="hidden fade-in">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold brand-title text-indigo-700 mb-2">üìã Job Description (JD) Matcher</h2>
                        <p class="text-lg text-slate-500">Paste a Job Description to compare against your profile and get an instant match score.</p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300">
                            <h3 class="text-xl font-bold mb-4 text-gray-700">Paste Job Description</h3>
                            <textarea id="jdInput" placeholder="Paste the full job description here..." class="input h-64 resize-none mb-4"></textarea>
                            <button type="button" class="btn-custom btn-orange w-full" id="analyzeJdBtn">
                                <i class="fas fa-search"></i> Analyze Match
                            </button>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-lg hover-lift transition-all duration-300">
                            <h3 class="text-xl font-bold mb-4 flex items-center gap-2 text-indigo-700 border-b pb-2">
                                <i class="fas fa-star-half-alt"></i> Match Score & Gap Analysis
                            </h3>
                            <div id="jdMatchOutput" class="space-y-4">
                                <div class="bg-gray-100 p-4 rounded-lg text-center">
                                    <div id="matchScore" class="text-5xl font-extrabold text-slate-500">‚Äî%</div>
                                    <div class="text-lg font-semibold text-gray-700 mt-1">Overall Match</div>
                                    <p id="matchComment" class="text-sm text-slate-500 mt-2">
                                        Paste a Job Description and click 'Analyze Match' to see your score.
                                    </p>
                                </div>

                                <div id="gapAnalysis" class="space-y-2">
                                    </div>

                                <div id="actionableRecs" class="p-3 border-t border-indigo-200 pt-4">
                                    <h4 class="font-bold text-md mb-2 text-indigo-700">Actionable Recommendations</h4>
                                    <ul id="recsList" class="list-disc list-inside text-sm text-slate-600 space-y-1">
                                        </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section id="interview-prep" class="hidden fade-in">
  <div class="mb-8">
    <h2 class="text-3xl font-bold brand-title text-indigo-700 mb-2">
      üéØ AI Interview Preparation 
    </h2>
    <p class="text-lg text-slate-500">
      Get personalized interview questions, answers, and coaching
    </p>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    
    <div class="bg-white p-6 rounded-xl shadow-lg">
      <input id="ipRole" class="input mb-3" placeholder="Job Role (e.g. Software Engineer)" />

      <input id="ipCompany"
        class="input mb-3"
        placeholder="Company Name (e.g. Google,Amazon,Zoho)" />
      <select id="ipLevel" class="input mb-3">
        <option value="">Experience Level</option>
        <option>Fresher</option>
        <option>1‚Äì3 Years</option>
        <option>3‚Äì5 Years</option>
        <option>5+ Years</option>
      </select>

      <textarea id="ipSkills" class="input mb-3 h-20 resize-none"
        placeholder="Skills (Java, Spring Boot, SQL...)"></textarea>

      <select id="ipType" class="input mb-3">
        <option value="">Interview Type</option>
        <option>Technical</option>
        <option>HR</option>
        <option>Managerial</option>
        <option>Behavioral</option>
        <option>Mock Interview</option>
      </select>

      <textarea id="ipWeak" class="input h-20 resize-none"
        placeholder="Weak areas (DSA, Communication...)"></textarea>

      <button onclick="generateInterviewPrep()"
        class="btn-custom btn-purple w-full mt-4">
        üöÄ Generate Interview Prep
      </button>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-lg lg:col-span-2">
      <h3 class="text-xl font-bold mb-3 text-indigo-700">
        AI Interview Guidance
      </h3>
      <div id="ipOutput" class="space-y-4 text-sm text-slate-600">
        <div class="p-4 bg-indigo-100 rounded-lg mb-4">
          <h4 class="text-xl font-extrabold text-indigo-800 flex items-center gap-2">
            <i class="fas fa-desktop"></i> Interview Snapshot
          </h4>
          <p class="text-sm text-slate-700 mt-1"><i class="fas fa-info-circle text-indigo-600"></i> Fill out the form and click 'Generate Interview Prep' to get company-specific analysis.</p>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
            <div class="p-3 bg-white rounded-lg border">
              <strong class="text-sm block">Dress Code (General)</strong>
              <p class="text-xs text-slate-600 mt-1">Defaults to business casual for most IT roles.</p>
            </div>
            <div class="p-3 bg-white rounded-lg border">
              <strong class="text-sm block">Interview Format (General)</strong>
              <p class="text-xs text-slate-600 mt-1">Expect 2-3 rounds, usually including Technical, Managerial, and HR interviews.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

                
                <section id="skills" class="hidden fade-in"></section>
                <section id="projects" class="hidden fade-in"></section>
                <section id="internships" class="hidden fade-in"></section>
                <section id="certificates" class="hidden fade-in"></section>
                <section id="education" class="hidden fade-in"></section>
                <section id="social" class="hidden fade-in"></section>
                
                <section id="resume" class="hidden fade-in">
                   <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-4">
    <h2 class="text-2xl font-bold flex items-center gap-2 text-slate-800">
        <i class="fas fa-file-pdf text-indigo-600"></i> Resume Preview
    </h2>
    <div class="flex items-center gap-3">
        <button id="customizeBtn" class="btn-premium btn-customize">
            <i class="fas fa-sliders-h"></i> Customize
        </button>
        <button id="downloadResume" class="btn-premium btn-download">
            <i class="fas fa-cloud-download-alt"></i> Download PDF
        </button>
    </div>
</div>
                        <p class="text-sm text-slate-500 mb-4">
                            <i class="fas fa-info-circle mr-1"></i>
                            <span class="font-semibold">Drag and drop sections to reorder your resume!</span>
                        </p>
                        <div id="resumePreview" class="resume-preview bg-gray-100 p-4 rounded-xl shadow-inner min-h-[30rem] overflow-hidden"></div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <div id="customizeBackdrop" class="fixed inset-0 bg-gray-900/50 flex items-center justify-center p-4 z-[1000] hidden backdrop-blur-sm">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-2xl hover-lift">
            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                <i class="fas fa-palette text-indigo-600"></i>Customize Resume
            </h3>

            <div class="mb-4">
                <h4 class="text-lg font-semibold mb-2">Select Sections</h4>
                <div class="flex flex-wrap gap-2">
                    <label class="chip flex items-center gap-2 p-2 rounded-lg bg-gray-100 text-sm cursor-pointer hover:bg-gray-200 transition-all duration-200">
                        <input type="checkbox" class="rs-cb accent-indigo-600" data-section="profile" checked> Professional Summary
                    </label>
                    <label class="chip flex items-center gap-2 p-2 rounded-lg bg-gray-100 text-sm cursor-pointer hover:bg-gray-200 transition-all duration-200">
                        <input type="checkbox" class="rs-cb accent-indigo-600" data-section="skills" checked> Skills
                    </label>
                    <label class="chip flex items-center gap-2 p-2 rounded-lg bg-gray-100 text-sm cursor-pointer hover:bg-gray-200 transition-all duration-200">
                        <input type="checkbox" class="rs-cb accent-indigo-600" data-section="projects" checked> Projects
                    </label>
                    <label class="chip flex items-center gap-2 p-2 rounded-lg bg-gray-100 text-sm cursor-pointer hover:bg-gray-200 transition-all duration-200">
                        <input type="checkbox" class="rs-cb accent-indigo-600" data-section="internships" checked> Work Experience
                    </label>
                    <label class="chip flex items-center gap-2 p-2 rounded-lg bg-gray-100 text-sm cursor-pointer hover:bg-gray-200 transition-all duration-200">
                        <input type="checkbox" class="rs-cb accent-indigo-600" data-section="certificates" checked> Certificates
                    </label>
                    <label class="chip flex items-center gap-2 p-2 rounded-lg bg-gray-100 text-sm cursor-pointer hover:bg-gray-200 transition-all duration-200">
                        <input type="checkbox" class="rs-cb accent-indigo-600" data-section="education" checked> Education
                    </label>
                    <label class="chip flex items-center gap-2 p-2 rounded-lg bg-gray-100 text-sm cursor-pointer hover:bg-gray-200 transition-all duration-200">
                        <input type="checkbox" class="rs-cb accent-indigo-600" data-section="social" checked> Social Media / Links
                    </label>
                </div>
            </div>

            <div class="mt-6 mb-4">
                <h4 class="text-lg font-semibold mb-2">Template Style</h4>
                <div class="flex flex-wrap gap-2">
                    <label class="flex items-center gap-2 p-2 rounded-lg bg-gray-100 text-sm cursor-pointer hover:bg-gray-200 transition-all duration-200">
                        <input type="radio" name="template" value="classic" checked class="accent-indigo-600"> Classic
                    </label>
                    <label class="flex items-center gap-2 p-2 rounded-lg bg-gray-100 text-sm cursor-pointer hover:bg-gray-200 transition-all duration-200">
                        <input type="radio" name="template" value="modern" class="accent-indigo-600"> Modern
                    </label>
                </div>
            </div>

            <div>
                <h4 class="text-lg font-semibold mb-2">Color Theme</h4>
                <div class="flex flex-wrap gap-2">
                    <label class="flex items-center gap-2 p-2 rounded-lg bg-gray-100 text-sm cursor-pointer hover:bg-gray-200 transition-all duration-200">
                        <input type="radio" name="theme" value="#6366f1|#4338ca" checked class="accent-indigo-600">
                        <span class="w-4 h-4 bg-indigo-500 rounded-full"></span> Indigo
                    </label>
                    <label class="flex items-center gap-2 p-2 rounded-lg bg-gray-100 text-sm cursor-pointer hover:bg-gray-200 transition-all duration-200">
                        <input type="radio" name="theme" value="#0ea5e9|#0369a1" class="accent-sky-600">
                        <span class="w-4 h-4 bg-sky-500 rounded-full"></span> Sky Blue
                    </label>
                    <label class="flex items-center gap-2 p-2 rounded-lg bg-gray-100 text-sm cursor-pointer hover:bg-gray-200 transition-all duration-200">
                        <input type="radio" name="theme" value="#22c55e|#16a34a" class="accent-green-600">
                        <span class="w-4 h-4 bg-green-500 rounded-full"></span> Green
                    </label>
                    <label class="flex items-center gap-2 p-2 rounded-lg bg-gray-100 text-sm cursor-pointer hover:bg-gray-200 transition-all duration-200">
                        <input type="radio" name="theme" value="#ef4444|#b91c1c" class="accent-red-600">
                        <span class="w-4 h-4 bg-red-500 rounded-full"></span> Red
                    </label>
                </div>
            </div>

            <div class="flex justify-end gap-3 mt-6">
                <button id="closeCustomize" class="btn-custom btn-red">
                    Cancel
                </button>
                <button id="applyCustomize" class="btn-custom btn-green">
                    Apply Changes
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script> 
<script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mammoth@1.4.21/mammoth.browser.min.js"></script>
    
    <script>
async function generateInterviewPrep() {
  const payload = {
    role: document.getElementById("ipRole").value,
    company: document.getElementById("ipCompany").value,
    experienceLevel: document.getElementById("ipLevel").value,
    skills: document.getElementById("ipSkills").value,
    interviewType: document.getElementById("ipType").value,
    weakAreas: document.getElementById("ipWeak").value
  };

  // üõë Validation (important)
  if (!payload.role || !payload.company || !payload.interviewType) {
    alert("Please enter role, company name, and interview type");
    return;
  }

  const output = document.getElementById("ipOutput");
  // Show a clean, centered loading state immediately
  output.innerHTML = `
    <div class="flex flex-col items-center justify-center py-10 text-indigo-600">
      <i class="fas fa-robot fa-spin text-4xl mb-3"></i>
      <p class="font-bold">AI is crafting your prep guide...</p>
      <p class="text-xs text-slate-500">Analyzing company data & patterns</p>
    </div>
  `;

  // ‚≠êÔ∏è CRITICAL FIX: Ensure the client calls the Node.js backend on port 3000
  const res = await fetch("https://careernest-backend-jbk3.onrender.com/api/interview-prep", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  if (!res.ok) {
     const errorText = await res.text();
     output.innerHTML = "‚ùå API Error. Check if server.js is running on port 3000. Server response: " + errorText.substring(0, 100) + "...";
     return;
  }
  
  let data;
  try {
    data = await res.json();
  } catch(e) {
    output.innerHTML = "‚ùå Failed to parse response from server as JSON. Server may have sent an error page.";
    return;
  }


  if (data.error) {
    output.innerHTML = "‚ùå " + data.error;
    return;
  }

  // Custom Render function to combine backend data with specific UI layout:
  const renderTabContent = (data, payload) => {
      // Use repeated_questions from AI response for Technical tab
      const technicalContent = data.repeated_questions.map((q, i) => `
        <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
            <strong class="block mb-2">Q${i + 1}. ${q.question}</strong>
            <div class="p-2 bg-green-50 rounded-md mb-2">
                <strong class="text-green-800"><i class="fas fa-lightbulb"></i> Model Answer:</strong>
                <p class="text-xs mt-1">${q.answer}</p>
            </div>
            <div class="p-2 bg-yellow-50 rounded-md">
                <strong class="text-yellow-800"><i class="fas fa-star"></i> Tips:</strong>
                <ol class="list-decimal list-inside text-xs mt-1">
                    <li>Focus on definitions, examples, and aligning your answer with the job role requirements and company technology stack.</li>
                </ol>
            </div>
        </div>
      `).join('');
      
      const behavioralContent = `
         <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
            <strong class="block mb-2">Q1. Tell me about a time when you had to work under pressure to meet a tight deadline. How did you handle the situation?</strong>
            <div class="p-2 bg-purple-50 rounded-md mb-2">
                <strong class="text-purple-800"><i class="fas fa-cogs"></i> Framework:</strong>
                <p class="text-xs mt-1">Use the Situation, Task, Action, Result (STAR) method. Focus on teamwork, prioritization, and positive outcomes under pressure.</p>
            </div>
            <div class="p-2 bg-yellow-50 rounded-md">
                <strong class="text-yellow-800"><i class="fas fa-star"></i> Tips:</strong>
                <ol class="list-decimal list-inside text-xs mt-1">
                    <li>Be concise and specific (Situation).</li>
                    <li>Emphasize problem-solving and time-management skills (Action).</li>
                    <li>Quantify the positive result of your actions (Result).</li>
                </ol>
            </div>
        </div>
        `;
      
      const companyContent = `
        <h4 class="text-lg font-bold text-gray-700 mb-3"><i class="fas fa-building text-indigo-600"></i> Company Insights & Research</h4>
        <div class="p-4 bg-indigo-50 rounded-lg">
          <strong class="block mb-2">üè¢ ${payload.company} Interview Pattern:</strong>
          <p class="text-xs">${data.company_insight}</p>
        </div>
        <h4 class="text-lg font-bold text-gray-700 mb-3 mt-4">üéØ What They Look For:</h4>
        <ul class="list-disc list-inside space-y-1 text-sm">
          ${data.what_they_look_for.map(x => `<li>${x}</li>`).join("")}
        </ul>
      `;
      
      const tipsContent = `
        <h4 class="text-lg font-bold text-gray-700 mb-3"><i class="fas fa-lightbulb text-yellow-600"></i> Preparation Checklist</h4>
        <ul class="list-decimal list-inside space-y-2 text-sm">
          ${data.tips.map(t => `<li>${t}</li>`).join("")}
        </ul>
        <h4 class="text-lg font-bold text-gray-700 mb-3 mt-4"><i class="fas fa-fire text-purple-600"></i> Confidence Advice:</h4>
        <div class="p-4 bg-purple-50 rounded-lg">
            <p>${data.confidence_advice}</p>
        </div>
      `;

      // Using the list of mistakes from the UI screenshots for this tab
      const mistakesContent = `
        <h4 class="text-lg font-bold text-gray-700 mb-3"><i class="fas fa-exclamation-triangle text-red-600"></i> Common Mistakes to Avoid</h4>
        <ul class="list-disc list-inside space-y-2 text-sm">
            <li class="text-red-600"><i class="fas fa-times-circle mr-1"></i>Failing to research the company's recent achievements and culture.</li>
            <li class="text-red-600"><i class="fas fa-times-circle mr-1"></i>Not aligning your skills and experiences with the company's core values and focus areas.</li>
            <li class="text-red-600"><i class="fas fa-times-circle mr-1"></i>Being unprepared to discuss how you can contribute to a collaborative and innovative environment.</li>
            <li class="text-red-600"><i class="fas fa-times-circle mr-1"></i>Neglecting to demonstrate your commitment to continuous learning and professional development.</li>
            <li class="text-red-600"><i class="fas fa-times-circle mr-1"></i>Overlooking the importance of quality management and not understanding the company's ISO certification.</li>
        </ul>
      `;
      
      return {
          Technical: technicalContent,
          Behavioral: behavioralContent,
          Company: companyContent,
          Tips: tipsContent,
          Mistakes: mistakesContent
      };
  };
  
  const content = renderTabContent(data, payload);
  
  // Set up the full new UI structure
  output.innerHTML = `
    <div class="p-4 bg-indigo-100 rounded-lg mb-4">
      <h4 class="text-xl font-extrabold text-indigo-800 flex items-center gap-2">
        <i class="fas fa-desktop"></i> ${payload.role}
      </h4>
      <p class="text-sm text-slate-700 mt-1"><i class="fas fa-building text-indigo-600"></i> ${payload.company}</p>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
        <div class="p-3 bg-white rounded-lg border">
          <strong class="text-sm block">Dress Code</strong>
          <p class="text-xs text-slate-600 mt-1">${payload.company} generally suggests business casual attire.</p>
        </div>
        <div class="p-3 bg-white rounded-lg border">
          <strong class="text-sm block">Interview Format</strong>
          <p class="text-xs text-slate-600 mt-1">Expect multiple rounds, including a focus on your ${payload.interviewType} skills.</p>
        </div>
      </div>
    </div>

    <div class="mt-6">
        <div id="tabButtons" class="flex border-b border-gray-200">
            <button data-tab="Technical" class="tab-btn px-4 py-2 text-sm font-semibold text-indigo-700 border-b-2 border-indigo-500">Technical</button>
            <button data-tab="Behavioral" class="tab-btn px-4 py-2 text-sm font-semibold text-slate-500 hover:text-indigo-700">Behavioral</button>
            <button data-tab="Company" class="tab-btn px-4 py-2 text-sm font-semibold text-slate-500 hover:text-indigo-700">Company</button>
            <button data-tab="Tips" class="tab-btn px-4 py-2 text-sm font-semibold text-slate-500 hover:text-indigo-700">Tips</button>
            <button data-tab="Mistakes" class="tab-btn px-4 py-2 text-sm font-semibold text-slate-500 hover:text-indigo-700">Mistakes</button>
        </div>
        
        <div id="tabContent" class="py-4 space-y-4">
            <div data-content="Technical" class="tab-content">${content.Technical}</div>
            <div data-content="Behavioral" class="tab-content hidden">${content.Behavioral}</div>
            <div data-content="Company" class="tab-content hidden">${content.Company}</div>
            <div data-content="Tips" class="tab-content hidden">${content.Tips}</div>
            <div data-content="Mistakes" class="tab-content hidden">${content.Mistakes}</div>
        </div>
    </div>
  `;
  
  // Add Tab Switching Logic (must be done after innerHTML is updated)
  const tabButtons = document.querySelectorAll('.tab-btn');
  const tabContents = document.querySelectorAll('.tab-content');

  const switchTab = (tabName) => {
      tabButtons.forEach(btn => {
          if (btn.dataset.tab === tabName) {
              btn.classList.add('text-indigo-700', 'border-indigo-500');
              btn.classList.remove('text-slate-500');
          } else {
              btn.classList.remove('text-indigo-700', 'border-indigo-500');
              btn.classList.add('text-slate-500');
          }
      });
      tabContents.forEach(content => {
          if (content.dataset.content === tabName) {
              content.classList.remove('hidden');
          } else {
              content.classList.add('hidden');
          }
      });
  };

  tabButtons.forEach(btn => {
      btn.addEventListener('click', () => switchTab(btn.dataset.tab));
  });

  // Ensure the Technical tab is active by default
  switchTab('Technical');
}


async function extractResumeText(file) {
  const ext = file.name.split('.').pop().toLowerCase();

  if (ext === "pdf") {
    const pdfjsLib = window.pdfjsLib; 
    if (!pdfjsLib) {
        throw new Error("PDF.js library failed to load.");
    }
    
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js';
    
    const buffer = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data: buffer }).promise; 
    let text = "";
    for (let i = 1; i <= pdf.numPages; i++) {
      const page = await pdf.getPage(i);
      const content = await page.getTextContent();
      text += content.items.map(it => it.str).join(" ") + "\n";
    }
    return text;
  }

  if (ext === "docx") {
    const buffer = await file.arrayBuffer();
    const result = await mammoth.extractRawText({ arrayBuffer: buffer });
    return result.value;
  }

  throw new Error("Unsupported file type or extraction failure.");
}
      async function analyzeResume(resumeText) {
  const res = await fetch("https://careernest-backend-jbk3.onrender.com/api/resume-score", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ resumeText })
  });

  if (!res.ok) {
    // Attempt to read error message if provided by the proxy for better debugging
    const errorBody = await res.text().catch(() => "Unknown error.");
    throw new Error(`Resume analysis failed on server (Status: ${res.status}): ${errorBody}`);
  }

  return await res.json();
}
      // Enhanced Theme Management System with Dark Mode (REMOVED)
      class ThemeManager {
        constructor() {
          this.themes = {
            light: {
              primary: '#6366f1',
              secondary: '#4338ca',
              background: '#f8fafc',
              surface: '#ffffff',
              text: '#1e293b',
              textSecondary: '#64748b',
              border: '#e2e8f0',
              cardBg: '#ffffff',
              sidebarBg: 'linear-gradient(180deg, #4338ca, #6366f1)',
              accent: '#10b981'
            }
          };
          
          this.currentTheme = 'light'; // Hardcode to light
          this.init();
        }

        init() {
          this.applyTheme(this.currentTheme);
        }

        applyTheme(themeName) {
          const theme = this.themes[themeName];
          const root = document.documentElement;

          // Apply CSS custom properties
          Object.entries(theme).forEach(([key, value]) => {
            root.style.setProperty(`--theme-${key}`, value);
          });
        }

        // Method for charts to get theme-appropriate colors
        getChartColors() {
          // Hardcoding light mode colors
          return {
            primary: ['#6366f1', '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444', '#ec4899'],
            background: '#ffffff',
            text: '#1e293b',
            grid: '#e5e7eb',
            tooltip: {
              background: '#ffffff',
              text: '#1e293b',
              border: '#d1d5db'
            }
          };
        }
      }

      // Skill Mapping and Analytics
      class SkillMapper {
        constructor() {
          this.skillCategories = {
            'Programming': ['JavaScript', 'Python', 'Java', 'C++', 'TypeScript', 'Go', 'Rust', 'PHP'],
            'Web Development': ['React', 'Vue', 'Angular', 'Node.js', 'Express', 'HTML', 'CSS', 'Tailwind'],
            'Mobile Development': ['React Native', 'Flutter', 'Swift', 'Kotlin', 'Xamarin'],
            'Data Science': ['Machine Learning', 'Data Analysis', 'Statistics', 'Pandas', 'NumPy', 'TensorFlow'],
            'DevOps': ['Docker', 'Kubernetes', 'AWS', 'Azure', 'CI/CD', 'Jenkins', 'Git'],
            'Database': ['MongoDB', 'PostgreSQL', 'MySQL', 'Redis', 'Firebase'],
            'Design': ['UI/UX', 'Figma', 'Adobe XD', 'Photoshop', 'Illustrator'],
            'Soft Skills': ['Leadership', 'Communication', 'Problem Solving', 'Team Work', 'Project Management']
          };
        }

        categorizeSkill(skillName) {
          for (const [category, skills] of Object.entries(this.skillCategories)) {
            if (skills.some(skill => skillName.toLowerCase().includes(skill.toLowerCase()))) {
              return category;
            }
          }
          return 'Other';
        }

        generateSkillMap(skills, projects, certificates, internships) {
          const skillMap = {};
          
          // Process direct skills
          skills.forEach(skill => {
            const category = this.categorizeSkill(skill.name);
            if (!skillMap[category]) skillMap[category] = { total: 0, count: 0, skills: [] };
            skillMap[category].total += skill.level;
            skillMap[category].count += 1;
            skillMap[category].skills.push({ name: skill.name, level: skill.level });
          });

          // Extract skills from projects
          projects.forEach(project => {
            const extractedSkills = this.extractSkillsFromText(project.desc + ' ' + project.title);
            extractedSkills.forEach(skillName => {
              const category = this.categorizeSkill(skillName);
              if (!skillMap[category]) skillMap[category] = { total: 0, count: 0, skills: [] };
              
              const existingSkill = skillMap[category].skills.find(s => s.name.toLowerCase() === skillName.toLowerCase());
              if (!existingSkill) {
                skillMap[category].skills.push({ name: skillName, level: 60, source: 'project' });
                skillMap[category].total += 60;
                skillMap[category].count += 1;
              }
            });
          });

          // Calculate averages
          Object.keys(skillMap).forEach(category => {
            skillMap[category].average = Math.round(skillMap[category].total / skillMap[category].count);
          });

          return skillMap;
        }

        extractSkillsFromText(text) {
          const allSkills = Object.values(this.skillCategories).flat();
          const foundSkills = [];
          
          allSkills.forEach(skill => {
            if (text.toLowerCase().includes(skill.toLowerCase())) {
              foundSkills.push(skill);
            }
          });
          
          return [...new Set(foundSkills)];
        }

        generateRadarChartData(skillMap) {
          const categories = Object.keys(skillMap);
          const data = categories.map(category => ({
            category,
            value: skillMap[category].average || 0,
            skills: skillMap[category].skills || []
          }));
          
          return data.sort((a, b) => b.value - a.value);
        }
        
        generatePieChartData(data) {
          const total = data.reduce((sum, item) => sum + item.value, 0);
          const pieData = data.map(item => ({
            ...item,
            percentage: total > 0 ? (item.value / total) * 100 : 0
          }));
          return pieData;
        }
        
        renderSkillRadarChart(containerId, data) {
          const container = document.getElementById(containerId);
          if (!container) return;

          // Create radar chart using Chart.js
          const canvas = document.createElement('canvas');
          canvas.width = 300;
          canvas.height = 300;
          container.innerHTML = '';
          container.appendChild(canvas);

          const ctx = canvas.getContext('2d');
          const themeManager = window.themeManager || new ThemeManager();
          const colors = themeManager.getChartColors();

          new Chart(ctx, {
            type: 'radar',
            data: {
              labels: data.map(item => item.category),
              datasets: [{
                label: 'Skill Level',
                data: data.map(item => item.value),
                backgroundColor: 'rgba(99, 102, 241, 0.2)',
                borderColor: '#6366f1',
                borderWidth: 2,
                pointBackgroundColor: '#6366f1',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 5
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false
                },
                tooltip: {
                  backgroundColor: colors.tooltip.background,
                  titleColor: colors.tooltip.text,
                  bodyColor: colors.tooltip.text,
                  borderColor: colors.tooltip.border,
                  borderWidth: 1,
                  callbacks: {
                    label: function(context) {
                      return `${context.label}: ${context.parsed.r}%`;
                    }
                  }
                }
              },
              scales: {
                r: {
                  beginAtZero: true,
                  max: 100,
                  ticks: {
                    stepSize: 20,
                    color: colors.text,
                    backdropColor: 'transparent'
                  },
                  grid: {
                    color: colors.grid
                  },
                  pointLabels: {
                    color: colors.text,
                    font: {
                      size: 12,
                      family: 'Inter'
                    }
                  }
                }
              }
            }
          });
        }

        renderBarChart(containerId, skillsData) {
          const container = document.getElementById(containerId);
          if (!container) return;

          const canvas = document.createElement('canvas');
          container.innerHTML = '';
          container.appendChild(canvas);

          const ctx = canvas.getContext('2d');
          const themeManager = window.themeManager || new ThemeManager();
          const colors = themeManager.getChartColors();

          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: skillsData.map(skill => skill.name),
              datasets: [{
                label: 'Skill Level (%)',
                data: skillsData.map(skill => skill.level),
                backgroundColor: colors.primary[0],
                borderColor: colors.primary[1],
                borderWidth: 2,
                borderRadius: 8,
                borderSkipped: false,
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false
                },
                tooltip: {
                  backgroundColor: colors.tooltip.background,
                  titleColor: colors.tooltip.text,
                  bodyColor: colors.tooltip.text,
                  borderColor: colors.tooltip.border,
                  borderWidth: 1,
                  callbacks: {
                    label: function(context) {
                      return `${context.label}: ${context.parsed.y}%`;
                    }
                  }
                }
              },
              scales: {
                x: {
                  ticks: {
                    color: colors.text,
                    maxRotation: 45
                  },
                  grid: {
                    color: colors.grid
                  }
                },
                y: {
                  beginAtZero: true,
                  max: 100,
                  ticks: {
                    color: colors.text,
                    callback: function(value) {
                      return value + '%';
                    }
                  },
                  grid: {
                    color: colors.grid
                  }
                }
              }
            }
          });
        }

        renderLineChart(containerId, progressData) {
          const container = document.getElementById(containerId);
          if (!container) return;

          const canvas = document.createElement('canvas');
          container.innerHTML = '';
          container.appendChild(canvas);

          const ctx = canvas.getContext('2d');
          const themeManager = window.themeManager || new ThemeManager();
          const colors = themeManager.getChartColors();

          new Chart(ctx, {
            type: 'line',
            data: {
              labels: progressData.labels,
              datasets: [{
                label: 'Skills Added',
                data: progressData.skills,
                borderColor: colors.primary[0],
                backgroundColor: colors.primary[0] + '20',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: colors.primary[0],
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 6
              }, {
                label: 'Projects Completed',
                data: progressData.projects,
                borderColor: colors.primary[2],
                backgroundColor: colors.primary[2] + '20',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: colors.primary[2],
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 6
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: true,
                  labels: {
                    color: colors.text,
                    usePointStyle: true,
                    padding: 20
                  }
                },
                tooltip: {
                  backgroundColor: colors.tooltip.background,
                  titleColor: colors.tooltip.text,
                  bodyColor: colors.tooltip.text,
                  borderColor: colors.tooltip.border,
                  borderWidth: 1
                }
              },
              scales: {
                x: {
                  ticks: {
                    color: colors.text
                  },
                  grid: {
                    color: colors.grid
                  }
                },
                y: {
                  beginAtZero: true,
                  ticks: {
                    color: colors.text
                  },
                  grid: {
                    color: colors.grid
                  }
                }
              }
            }
          });
        }

        renderPieChart(containerId, pieData) {
          const container = document.getElementById(containerId);
          if (!container) return;

          const canvas = document.createElement('canvas');
          container.innerHTML = '';
          container.appendChild(canvas);

          const ctx = canvas.getContext('2d');
          const themeManager = window.themeManager || new ThemeManager();
          const colors = themeManager.getChartColors();

          new Chart(ctx, {
            type: 'doughnut',
            data: {
              labels: pieData.map(item => item.category),
              datasets: [{
                data: pieData.map(item => item.value),
                backgroundColor: colors.primary,
                borderColor: colors.background,
                borderWidth: 3,
                hoverBorderWidth: 5
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: 'bottom',
                  labels: {
                    color: colors.text,
                    padding: 20,
                    usePointStyle: true
                  }
                },
                tooltip: {
                  backgroundColor: colors.tooltip.background,
                  titleColor: colors.tooltip.text,
                  bodyColor: colors.tooltip.text,
                  borderColor: colors.tooltip.border,
                  borderWidth: 1,
                  callbacks: {
                    label: function(context) {
                      const total = context.dataset.data.reduce((a, b) => a + b, 0);
                      const percentage = ((context.parsed / total) * 100).toFixed(1);
                      return `${context.label}: ${context.parsed} (${percentage}%)`;
                    }
                  }
                }
              }
            }
          });
        }
      }

      // Gamification System
      class GamificationSystem {
        constructor() {
          this.badges = {
            'first_project': { name: 'First Steps', icon: 'üöÄ', description: 'Created your first project' },
            'project_master': { name: 'Project Master', icon: 'üèÜ', description: 'Completed 5+ projects' },
            'skill_collector': { name: 'Skill Collector', icon: 'üéØ', description: 'Added 10+ skills' },
            'certified_pro': { name: 'Certified Pro', icon: 'üèÖ', description: 'Earned 3+ certificates' },
            'experience_builder': { name: 'Experience Builder', icon: 'üíº', description: 'Added work experience' },
            'social_connector': { name: 'Social Connector', icon: 'üîó', description: 'Connected social profiles' },
            'profile_complete': { name: 'Profile Complete', icon: '‚ú®', description: 'Completed your profile' },
            'streak_warrior': { name: 'Streak Warrior', icon: 'üî•', description: 'Updated profile 7 days in a row' },
            'overachiever': { level: 10, name: 'Overachiever', icon: '‚≠ê', description: 'Reached level 10' },
            'resume_ready': { name: 'Resume Ready', icon: 'üìÑ', description: 'Generated your first resume' }
          };

          this.levels = [
            { level: 1, name: 'Beginner', xpRequired: 0, color: '#94a3b8' },
            { level: 2, name: 'Explorer', xpRequired: 100, color: '#06b6d4' },
            { level: 3, name: 'Developer', xpRequired: 250, color: '#10b981' },
            { level: 4, name: 'Contributor', xpRequired: 500, color: '#f59e0b' },
            { level: 5, name: 'Expert', xpRequired: 1000, color: '#ef4444' },
            { level: 6, name: 'Master', xpRequired: 1500, color: '#8b5cf6' },
            { level: 7, name: 'Guru', xpRequired: 2500, color: '#ec4899' },
            { level: 8, name: 'Legend', xpRequired: 4000, color: '#f97316' },
            { level: 9, name: 'Champion', xpRequired: 6000, color: '#84cc16' },
            { level: 10, name: 'Grandmaster', xpRequired: 10000, color: '#6366f1' }
          ];
        }

        getUserKey(baseKey, userId) {
          return `${baseKey}_${userId}`;
        }

        getGameData(userId) {
          const key = this.getUserKey('cn_game_data', userId);
          return JSON.parse(localStorage.getItem(key)) || {
            xp: 0,
            level: 1,
            badges: [],
            streak: 0,
            lastUpdate: null,
            achievements: []
          };
        }

        saveGameData(userId, data) {
          const key = this.getUserKey('cn_game_data', userId);
          localStorage.setItem(key, JSON.stringify(data));
        }

        calculateXP(profile, skills, projects, certificates, internships, social, education) {
          let xp = 0;
          
          // Profile completion XP
          if (profile.name) xp += 20;
          if (profile.email) xp += 10;
          if (profile.phone) xp += 10;
          if (profile.bio) xp += 30;
          if (profile.photo) xp += 40;
          
          // Skills XP
          xp += skills.length * 15;
          xp += skills.reduce((sum, skill) => sum + (skill.level || 0), 0) * 0.5;
          
          // Projects XP
          xp += projects.length * 50;
          xp += projects.filter(p => p.link).length * 20;
          
          // Certificates XP
          xp += certificates.length * 40;
          
          // Experience XP
          xp += internships.length * 60;
          
          // Social XP
          xp += social.length * 25;
          
          // Education XP
          xp += education.length * 35;
          
          return Math.round(xp);
        }

        getCurrentLevel(xp) {
          for (let i = this.levels.length - 1; i >= 0; i--) {
            if (xp >= this.levels[i].xpRequired) {
              return this.levels[i];
            }
          }
          return this.levels[0];
        }

        getNextLevel(currentLevel) {
          const currentIndex = this.levels.findIndex(l => l.level === currentLevel.level);
          return currentIndex < this.levels.length - 1 ? this.levels[currentIndex + 1] : null;
        }

        checkBadges(profile, skills, projects, certificates, internships, social, gameData) {
          const newBadges = [];
          
          // Check each badge condition
          if (projects.length >= 1 && !gameData.badges.includes('first_project')) {
            newBadges.push('first_project');
          }
          
          if (projects.length >= 5 && !gameData.badges.includes('project_master')) {
            newBadges.push('project_master');
          }
          
          if (skills.length >= 10 && !gameData.badges.includes('skill_collector')) {
            newBadges.push('skill_collector');
          }
          
          if (certificates.length >= 3 && !gameData.badges.includes('certified_pro')) {
            newBadges.push('certified_pro');
          }
          
          if (internships.length >= 1 && !gameData.badges.includes('experience_builder')) {
            newBadges.push('experience_builder');
          }
          
          if (social.length >= 2 && !gameData.badges.includes('social_connector')) {
            newBadges.push('social_connector');
          }
          
          const profileComplete = profile.name && profile.email && profile.bio && profile.photo;
          if (profileComplete && !gameData.badges.includes('profile_complete')) {
            newBadges.push('profile_complete');
          }
          
          if (gameData.level >= 10 && !gameData.badges.includes('overachiever')) {
            newBadges.push('overachiever');
          }
          
          return newBadges;
        }

        updateStreak(gameData) {
          const today = new Date().toDateString();
          const lastUpdate = gameData.lastUpdate ? new Date(gameData.lastUpdate).toDateString() : null;
          
          if (lastUpdate === today) {
            // Already updated today
            return gameData.streak;
          }
          
          const yesterday = new Date();
          yesterday.setDate(yesterday.getDate() - 1);
          const yesterdayStr = yesterday.toDateString();
          
          if (lastUpdate === yesterdayStr) {
            // Continuing streak
            gameData.streak += 1;
          } else if (lastUpdate !== today) {
            // Streak broken or first time
            gameData.streak = 1;
          }
          
          gameData.lastUpdate = new Date().toISOString();
          
          // Check streak badge
          if (gameData.streak >= 7 && !gameData.badges.includes('streak_warrior')) {
            gameData.badges.push('streak_warrior');
            return { newBadge: 'streak_warrior', streak: gameData.streak };
          }
          
          return gameData.streak;
        }

        renderGameStats(containerId, gameData, currentLevel, nextLevel) {
          const container = document.getElementById(containerId);
          if (!container) return;
          
          const progressPercent = nextLevel ? 
            ((gameData.xp - currentLevel.xpRequired) / (nextLevel.xpRequired - currentLevel.xpRequired)) * 100 : 100;
          
          container.innerHTML = `
            <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-6 rounded-xl shadow-lg">
              <div class="flex items-center justify-between mb-4">
                <div>
                  <h3 class="text-2xl font-bold">${currentLevel.name}</h3>
                  <p class="text-indigo-100">Level ${currentLevel.level}</p>
                </div>
                <div class="text-right">
                  <div class="text-3xl font-bold">${gameData.xp}</div>
                  <p class="text-indigo-100 text-sm">Total XP</p>
                </div>
              </div>
              
              <div class="mb-4">
                <div class="flex justify-between text-sm mb-1">
                  <span>Progress to ${nextLevel ? nextLevel.name : 'Max Level'}</span>
                  <span>${Math.round(progressPercent)}%</span>
                </div>
                <div class="w-full bg-white/20 rounded-full h-3">
                  <div class="bg-white h-3 rounded-full transition-all duration-500" style="width: ${progressPercent}%"></div>
                </div>
                ${nextLevel ? `<p class="text-xs text-indigo-100 mt-1">${nextLevel.xpRequired - gameData.xp} XP to next level</p>` : ''}
              </div>
              
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <span class="text-2xl">üî•</span>
                  <div>
                    <div class="font-semibold">${gameData.streak} Day Streak</div>
                    <div class="text-xs text-indigo-100">Keep it up!</div>
                  </div>
                </div>
                <div class="flex items-center gap-2">
                  <span class="text-2xl">üèÜ</span>
                  <div>
                    <div class="font-semibold">${gameData.badges.length} Badges</div>
                    <div class="text-xs text-indigo-100">Earned</div>
                  </div>
                </div>
              </div>
            </div>
          `;
        }

        renderBadges(containerId, earnedBadges) {
          const container = document.getElementById(containerId);
          if (!container) return;
          
          const badgeElements = earnedBadges.map(badgeId => {
            const badge = this.badges[badgeId];
            return `
              <div class="bg-white p-4 rounded-lg shadow-md text-center hover:shadow-lg transition-shadow">
                <div class="text-3xl mb-2">${badge.icon}</div>
                <h4 class="font-semibold text-sm">${badge.name}</h4>
                <p class="text-xs text-gray-500 mt-1">${badge.description}</p>
              </div>
            `;
          }).join('');
          
          container.innerHTML = `
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
              ${badgeElements || '<p class="text-gray-500 col-span-full text-center">No badges earned yet. Keep building your profile!</p>'}
            </div>
          `;
        }

        showLevelUpNotification(newLevel) {
          const notification = document.createElement('div');
          notification.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-8 rounded-xl shadow-2xl z-50 text-center animate-bounce';
          notification.innerHTML = `
            <div class="text-6xl mb-4">üéâ</div>
            <h2 class="text-3xl font-bold mb-2">Level Up!</h2>
            <p class="text-xl">You're now a <strong>${newLevel.name}</strong></p>
            <p class="text-lg">Level ${newLevel.level}</p>
          `;
          
          document.body.appendChild(notification);
          
          setTimeout(() => {
            notification.remove();
          }, 4000);
        }

        showBadgeNotification(badgeId) {
          const badge = this.badges[badgeId];
          const notification = document.createElement('div');
          notification.className = 'fixed top-4 right-4 bg-gradient-to-r from-green-400 to-blue-500 text-white p-6 rounded-xl shadow-lg z-50 animate-pulse';
          notification.innerHTML = `
            <div class="flex items-center gap-3">
              <div class="text-3xl">${badge.icon}</div>
              <div>
                <h3 class="font-bold">Badge Earned!</h3>
                <p class="text-sm">${badge.name}</p>
              </div>
            </div>
          `;
          
          document.body.appendChild(notification);
          
          setTimeout(() => {
            notification.remove();
          }, 5000);
        }
      }

      // External Platform Integrations (Class removed for brevity/irrelevance to the core fix)
      
      // Dashboard functionality with user authentication (RESTORED TO LOCAL STORAGE)
  class CareerNestDashboard {
        constructor() {
        this.currentUser = null;
        this.themeManager = null;
        this.skillMapper = null;
        this.gamificationSystem = null;
        
        // --- NEW CACHING PROPERTIES ---
        this.lastAnalyzedFile = null; 
        this.lastAnalyzedResult = null;
        // ------------------------------
        this.lastAnalyzedJdText = null;
        this.lastJdMatchResult = null;
        
        // ‚≠ê ADD THIS: New Persistent ATS Score Property
        this.atsPersistence = null; 
        
        // ‚≠ê NEW PROPERTY
        this.isFirstLogin = false; 
        
        this.init();
    }

        init() {
          // Check authentication
          const savedUser = localStorage.getItem('cn_current_user');
          if (!savedUser) {
            console.log('No user session found, redirecting to login page.');
            window.location.href = 'index.html';
            return;
          }

          try {
            console.log('User session found. Initializing dashboard...');
            this.currentUser = JSON.parse(savedUser);
            
            // ‚≠ê NEW LOGIC: Check for first login flag
            const firstLoginKey = `cn_first_login_${this.currentUser.id}`;
            const isFirstLogin = localStorage.getItem(firstLoginKey);

            if (isFirstLogin === 'true') {
                this.isFirstLogin = true;
                // Clear the flag immediately after retrieving it for this session
                localStorage.removeItem(firstLoginKey); 
            }
            // Initialize systems
            this.themeManager = new ThemeManager();
            window.themeManager = this.themeManager; // Make globally available
            this.skillMapper = new SkillMapper();
            this.gamificationSystem = new GamificationSystem();
            
            this.setupUserInterface();
            this.initializeData(); 
            this.setupEventListeners();
            this.renderAll();
          } catch (error) {
            console.error('Error initializing dashboard:', error);
            localStorage.removeItem('cn_current_user');
            window.location.href = 'index.html';
          }
        }

        setupUserInterface() {
          // ‚≠ê MODIFIED: Check first login flag to set the correct welcome message
          const welcomeMessage = this.isFirstLogin ? 'Welcome!' : 'Welcome back!';
          
          // Display user name in sidebar
          const userNameDisplay = document.getElementById('userNameDisplay');
          const welcomeBackDisplay = userNameDisplay ? userNameDisplay.closest('div').querySelector('.text-xs') : null;
          
          if (userNameDisplay) {
            userNameDisplay.textContent = this.currentUser.name || 'User';
          }
          if (welcomeBackDisplay) {
            // Update sidebar message
            welcomeBackDisplay.textContent = welcomeMessage;
          }
          // Display welcome name
          const welcomeName = document.getElementById('welcomeName');
          if (welcomeName) {
            welcomeName.textContent = this.currentUser.name || 'User';
          }
          const welcomeTextElement = document.querySelector('#home h1.brand-title');
          if (welcomeTextElement) {
              const baseText = this.isFirstLogin ? 'Welcome, ' : 'Welcome back, ';
              welcomeTextElement.innerHTML = baseText + `<span id="welcomeName">${this.currentUser.name || 'User'}</span>! üëã`;
          }

          // Mobile Menu Toggle Logic
          const sidebar = document.querySelector('.sidebar-bg');
          const menuToggle = document.getElementById('menuToggle');
          const navLinks = document.querySelectorAll('.nav-link');
          
          if(menuToggle && sidebar) {
              menuToggle.addEventListener('click', () => {
                  sidebar.classList.toggle('open');
                  if(sidebar.classList.contains('open')) {
                      menuToggle.innerHTML = '<i class="fas fa-times text-xl"></i>';
                  } else {
                      menuToggle.innerHTML = '<i class="fas fa-bars text-xl"></i>';
                  }
              });

              // Close sidebar when a link is clicked (mobile only)
              navLinks.forEach(link => {
                  link.addEventListener('click', () => {
                      if (window.innerWidth < 1024) {
                          sidebar.classList.remove('open');
                          menuToggle.innerHTML = '<i class="fas fa-bars text-xl"></i>';
                      }
                  });
              });
          }
        }

        getUserKey(baseKey) {
          return `${baseKey}_${this.currentUser.id}`;
        }

        // Synchronous data loading using localStorage
        initializeData() {
          this.KEY_PROFILE = this.getUserKey('mc_profile_v6');
          this.KEY_PROJECTS = this.getUserKey('mc_projects_v5');
          this.KEY_SKILLS = this.getUserKey('mc_skills_v5');
          this.KEY_CERTS = this.getUserKey('mc_certs_v5');
          this.KEY_EDU = this.getUserKey('mc_edu_v5');
          this.KEY_INTERNS = this.getUserKey('mc_interns_v2');
          this.KEY_SOCIAL = this.getUserKey('mc_social_v2');
          this.KEY_PREF = this.getUserKey('mc_prefs_v4');
          
          // ‚≠ê ADD THIS: New Persistence Key
          this.KEY_ATS_SCORE = this.getUserKey('cn_ats_score_cache');

          this.profile = this.load(this.KEY_PROFILE, this.currentUser.profile || {
            name: this.currentUser.name || '',
            email: this.currentUser.email || '',
            phone: '',
            bio: '',
            photo: ''
          });
          
          this.projects = this.load(this.KEY_PROJECTS, []);
          this.skills = this.load(this.KEY_SKILLS, []);
          this.certs = this.load(this.KEY_CERTS, []);
          this.edu = this.load(this.KEY_EDU, []);
          this.interns = this.load(this.KEY_INTERNS, []);
          this.social = this.load(this.KEY_SOCIAL, []);

          // ‚≠ê ADD THIS: Load persistent ATS Score
          this.atsPersistence = this.load(this.KEY_ATS_SCORE, null);


          const defaultSections = {profile:true, skills:true, projects:true, internships:true, certificates:true, education:true, social:true};
          const defaultOrder = ['profile', 'skills', 'projects', 'internships', 'certificates', 'education', 'social'];
          
          this.prefs = this.load(this.KEY_PREF, {
            sections: defaultSections,
            order: defaultOrder,
            theme: ['#6366f1', '#4338ca'],
            template: 'classic'
          });

          defaultOrder.forEach(sec => {
            if (this.prefs.sections[sec] === undefined) this.prefs.sections[sec] = true;
          });
          if (this.prefs.order.length !== defaultOrder.length) this.prefs.order = defaultOrder;
        }

        load(key, fallback) {
          try {
            return JSON.parse(localStorage.getItem(key)) || fallback;
          } catch {
            return fallback;
          }
        }

        save(key, value) {
          localStorage.setItem(key, JSON.stringify(value));
        }
        
        setupEventListeners() {
          // Navigation
          const navLinks = document.querySelectorAll('.nav-link');
          navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
              e.preventDefault();
              this.navigate(link.dataset.target);
            });
          });

          // Logout
          document.getElementById('logoutBtn').addEventListener('click', () => {
            if (confirm('Are you sure you want to logout?')) {
              localStorage.removeItem('cn_current_user');
              window.location.href = 'index.html';
            }
          });

          // Forms
          // In setupEventListeners() around line 1180
// Forms
this.setupFormHandlers();
this.setupCustomizeModal();
this.setupExportHandlers();

// NEW TOOL HANDLERS
document.getElementById('coachForm').addEventListener('submit', (e) => this.handleCoachFormSubmit(e)); // ‚≠ê UPDATED TO NEW METHOD NAME
document.getElementById('resumeUpload').addEventListener('change', () => this.handleResumeFileChange());
document.getElementById('scoreResumeBtn').addEventListener('click', () => this.handleScoreResume());
document.getElementById('analyzeJdBtn').addEventListener('click', () => this.handleAnalyzeJd());
        }

        navigate(pageId) {
          // Update active nav link
          document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
          });
          const targetLink = document.querySelector(`[data-target="${pageId}"]`);
          if (targetLink) {
              targetLink.classList.add('active'); 
          }

          // Show page
          document.querySelectorAll('section').forEach(section => {
            section.classList.add('hidden');
          });
          const targetSection = document.getElementById(pageId);
          if (targetSection) {
              targetSection.classList.remove('hidden');
              this.renderPageContent(pageId);
          }
          
          history.replaceState(null, '', '#' + pageId);
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        renderPageContent(pageId) {
          switch (pageId) {
            case 'profile':
              this.updateFormFields();
              this.renderLists();
              break;
            case 'analytics':
              this.renderAnalytics();
              break;
            case 'achievements':
              this.renderAchievements();
              break;
            case 'resume':
                this.renderResumePreview();
                break;
          }
        }
        // In CareerNestDashboard class, around line 2038
// --- PART 1: AI CAREER COACH IMPLEMENTATION ---
async handleCoachFormSubmit(e) { // ‚≠ê CHANGED TO ASYNC METHOD
    e.preventDefault();

    const btn = document.getElementById('generateRoadmapBtn');
    const output = document.getElementById("roadmapOutput");
    
    // ‚≠ê Get and Save Target Role before API call
    const targetRole = document.getElementById("targetRole").value;
    localStorage.setItem('cn_career_target_role', targetRole); 
    this.renderDashboard(); // Update home screen status cards instantly
    // ‚≠ê END NEW

    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating Roadmap...';
    output.innerHTML = `<div class="text-indigo-600 font-semibold p-4">Analyzing profile and plotting personalized roadmap...</div>`;


    const payload = {
        currentRole: document.getElementById("currentRole").value,
        targetRole: targetRole, // Use targetRole variable
        experienceYears: document.getElementById("experienceYears").value,
        currentSkills: document.getElementById("coachSkills").value,
        careerGoals: document.getElementById("careerGoals").value,
        timeline: document.getElementById("timeline").value
    };

    try {
        const res = await fetch("https://careernest-backend-jbk3.onrender.com/api/career-coach", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        if (!res.ok) {
            const errorBody = await res.json().catch(() => ({ error: "Server responded with an error." }));
            throw new Error(`API failed: ${errorBody.error}`);
        }

        const data = await res.json();
        this.showNotification('Roadmap generated successfully!');

        output.innerHTML = `
          <div class="bg-indigo-100 border border-indigo-300 p-4 rounded-lg shadow-sm">
            <h4 class="font-bold text-lg text-indigo-800 mb-2">Career Direction Summary</h4>
            <p class="text-slate-700">${data.summary}</p>
          </div>
          
          <div class="mt-6">
            <h3 class="text-xl font-bold text-indigo-700 mb-3 border-b pb-1"><i class="fas fa-route mr-2"></i>Personalized Roadmap</h3>
            ${data.roadmap.map(p => `
              <div class="mt-3 p-4 border-l-4 border-indigo-400 bg-indigo-50 rounded-lg shadow-sm">
                <h4 class="text-lg font-bold text-indigo-800">${p.phase}</h4>
                <p class="text-xs text-slate-600 mb-2">Duration: ${p.duration}</p>
                <div class="font-semibold text-sm text-slate-700 mt-2">Key Focus: ${p.focus.join(", ")}</div>
                <ul class="list-disc list-inside text-sm text-slate-700 pl-4 mt-2">
                  ${p.actions.map(a => `<li>${a}</li>`).join("")}
                </ul>
              </div>
            `).join("")}
          </div>
          
          <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <h3 class="text-xl font-bold text-indigo-700 mb-3 border-b pb-1"><i class="fas fa-exclamation-triangle mr-2"></i>Identified Skill Gaps</h3>
                <div class="flex flex-wrap gap-2">
                    ${data.skill_gaps.map(s => `<span class="bg-red-100 text-red-700 text-sm font-semibold px-3 py-1 rounded-full">${s}</span>`).join("")}
                </div>
                <h3 class="text-xl font-bold text-indigo-700 mb-3 border-b pb-1 mt-6"><i class="fas fa-medal mr-2"></i>Certifications</h3>
                <ul class="list-disc list-inside text-sm text-slate-700">
                  ${data.certifications.map(c => `<li>${c}</li>`).join("")}
                </ul>
            </div>
            
            <div>
                <h3 class="text-xl font-bold text-indigo-700 mb-3 border-b pb-1"><i class="fas fa-lightbulb mr-2"></i>Recommended Projects</h3>
                <ul class="list-disc list-inside text-sm text-slate-700">
                  ${data.project_ideas.map(p => `<li>${p}</li>`).join("")}
                </ul>
                <h3 class="text-xl font-bold text-indigo-700 mb-3 border-b pb-1 mt-6"><i class="fas fa-calendar-alt mr-2"></i>Daily Practice Plan</h3>
                <ul class="list-disc list-inside text-sm text-slate-700">
                  ${data.daily_plan.map(d => `<li>${d}</li>`).join("")}
                </ul>
            </div>
          </div>
        `;
    } catch (err) {
        output.innerHTML = `<div class="text-red-600 p-4 bg-red-50 border border-red-200 rounded-lg"><i class="fas fa-exclamation-circle mr-2"></i>Failed to generate roadmap: ${err.message}</div>`;
        this.showNotification(`Error: ${err.message}`, true);
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-route"></i> Generate Personalized Roadmap';
    }
}
        
        renderAnalytics() {
          // Generate skill map
          const skillMap = this.skillMapper.generateSkillMap(this.skills, this.projects, this.certs, this.interns);
          const radarData = this.skillMapper.generateRadarChartData(skillMap);
          
          // Render radar chart
          this.skillMapper.renderSkillRadarChart('skillRadarChart', radarData);
          
          // Render skill breakdown
          const skillBreakdown = document.getElementById('skillBreakdown');
          if (skillBreakdown) {
            skillBreakdown.innerHTML = radarData.map(item => `
              <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                <span class="text-sm font-medium">${item.category}</span>
                <span class="text-sm text-indigo-600 font-semibold">${item.value}%</span>
              </div>
            `).join('');
          }
          
          // Render new interactive charts
          this.renderInteractiveCharts();
          
          // Render progress timeline
          this.renderProgressTimeline();
          
          // Render detailed stats
          this.renderDetailedStats(skillMap);
        }
        
        renderInteractiveCharts() {
          // Skills Bar Chart
          const topSkills = this.skills.slice(0, 8);
          this.skillMapper.renderBarChart('skillsBarChart', topSkills);
          
          // Progress Line Chart - simulate progress over time
          const progressData = {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            skills: [2, 5, 8, 12, 15, this.skills.length],
            projects: [0, 1, 2, 4, 6, this.projects.length]
          };
          this.skillMapper.renderLineChart('progressLineChart', progressData);
          
          // Achievement Pie Chart
          const achievementData = [
            { category: 'Skills', value: this.skills.length },
            { category: 'Projects', value: this.projects.length },
            { category: 'Certificates', value: this.certs.length },
            { category: 'Experience', value: this.interns.length },
            { category: 'Education', value: this.edu.length }
          ].filter(item => item.value > 0);
          
          this.skillMapper.renderPieChart('achievementPieChart', achievementData);
        }
        
        renderProgressTimeline() {
          const timeline = document.getElementById('progressTimeline');
          if (!timeline) return;
          
          const events = [
            { date: 'Today', event: 'Profile Updated', type: 'profile' },
            { date: 'This Week', event: `${this.projects.length} Projects Added`, type: 'project' },
            { date: 'This Month', event: `${this.skills.length} Skills Mastered`, type: 'skill' },
            { date: 'Recent', event: `${this.certs.length} Certificates Earned`, type: 'cert' }
          ];
          
          timeline.innerHTML = events.map(event => `
            <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
              <div class="w-3 h-3 bg-indigo-500 rounded-full"></div>
              <div class="flex-1">
                <div class="font-semibold text-sm">${event.event}</div>
                <div class="text-xs text-gray-500">${event.date}</div>
              </div>
            </div>
          `).join('');
        }
        
        renderDetailedStats(skillMap) {
          // Skill categories
          const skillCategories = document.getElementById('skillCategories');
          if (skillCategories) {
            skillCategories.innerHTML = Object.entries(skillMap).map(([category, data]) => `
              <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                <span class="text-sm">${category}</span>
                <span class="text-sm font-semibold">${data.count} skills</span>
              </div>
            `).join('');
          }
          
          // Project technologies
          const projectTech = document.getElementById('projectTechnologies');
          if (projectTech) {
            const techs = this.projects.flatMap(p => this.skillMapper.extractSkillsFromText(p.desc + ' ' + p.title));
            const techCount = {};
            techs.forEach(tech => techCount[tech] = (techCount[tech] || 0) + 1);
            
            projectTech.innerHTML = Object.entries(techCount).slice(0, 5).map(([tech, count]) => `
              <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                <span class="text-sm">${tech}</span>
                <span class="text-sm font-semibold">${count} projects</span>
              </div>
            `).join('');
          }
          
          // Achievement summary
          const achievementSummary = document.getElementById('achievementSummary');
          if (achievementSummary) {
            const gameData = this.gamificationSystem.getGameData(this.currentUser.id);
            achievementSummary.innerHTML = `
              <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                <span class="text-sm">Total XP</span>
                <span class="text-sm font-semibold">${gameData.xp}</span>
              </div>
              <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                <span class="text-sm">Current Level</span>
                <span class="text-sm font-semibold">${gameData.level}</span>
              </div>
              <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                <span class="text-sm">Badges Earned</span>
                <span class="text-sm font-semibold">${gameData.badges.length}</span>
              </div>
            `;
          }
        }
        
        renderAchievements() {
          const gameData = this.gamificationSystem.getGameData(this.currentUser.id);
          const currentLevel = this.gamificationSystem.getCurrentLevel(gameData.xp);
          const nextLevel = this.gamificationSystem.getNextLevel(currentLevel);
          
          // Render level progress
          this.gamificationSystem.renderGameStats('levelProgress', gameData, currentLevel, nextLevel);
          
          // Render badges
          this.gamificationSystem.renderBadges('badgesContainer', gameData.badges);
        }

        setupFormHandlers() {
          // Profile form
          const profileForm = document.getElementById('profileForm');
          profileForm.addEventListener('submit', (e) => {
            e.preventDefault();
            this.profile.name = document.getElementById('name').value.trim();
            this.profile.email = document.getElementById('email').value.trim();
            this.profile.phone = document.getElementById('phone').value.trim();
            this.profile.bio = document.getElementById('bio').value.trim();
            this.save(this.KEY_PROFILE, this.profile);
            this.updateGameData();
            this.renderAll();
            this.showNotification('Profile saved successfully!');
          });

          // Photo upload
          document.getElementById('photoUpload').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (event) => {
                this.profile.photo = event.target.result;
                this.save(this.KEY_PROFILE, this.profile);
                this.updatePhotoPreview();
                this.updateGameData();
                this.renderAll();
              };
              reader.readAsDataURL(file);
            }
          });

          // Skills form
          const skillsForm = document.getElementById('skillsForm');
          const skillLevel = document.getElementById('skillLevel');
          const skillLevelVal = document.getElementById('skillLevelVal');
          
          skillLevel.addEventListener('input', () => {
            skillLevelVal.textContent = skillLevel.value + '%';
          });

          skillsForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('skillName').value.trim();
            const level = parseInt(document.getElementById('skillLevel').value || 0);
            
            if (!name) {
              this.showNotification('Please enter a skill name', true);
              return;
            }
            
            this.skills.unshift({name, level});
            this.save(this.KEY_SKILLS, this.skills);
            document.getElementById('skillName').value = '';
            document.getElementById('skillLevel').value = '75';
            skillLevelVal.textContent = '75%';
            this.updateGameData();
            this.renderAll();
          });

          // Projects form
          document.getElementById('projectsForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const title = document.getElementById('projectTitle').value.trim();
            const link = document.getElementById('projectLink').value.trim();
            const desc = document.getElementById('projectDesc').value.trim();
            
            if (!title) {
              this.showNotification('Please enter a project title', true);
              return;
            }
            
            this.projects.unshift({title, link, desc});
            this.save(this.KEY_PROJECTS, this.projects);
            this.clearForm('projectsForm');
            this.updateGameData();
            this.renderAll();
          });

          // Similar handlers for other forms...
          this.setupOtherFormHandlers();
          this.setupClearButtons();
        }

        setupOtherFormHandlers() {
          // Internships
          document.getElementById('internForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const company = document.getElementById('internCompany').value.trim();
            const role = document.getElementById('internRole').value.trim();
            const duration = document.getElementById('internDuration').value.trim();
            const desc = document.getElementById('internDesc').value.trim();
            
            if (!company || !role) {
              this.showNotification('Please enter company and role', true);
              return;
            }
            
            this.interns.unshift({company, role, duration, desc});
            this.save(this.KEY_INTERNS, this.interns);
            this.clearForm('internForm');
            this.updateGameData();
            this.renderAll();
          });

          // Certificates
          document.getElementById('certForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const title = document.getElementById('certName').value.trim();
            const issuer = document.getElementById('certIssuer').value.trim();
            const link = document.getElementById('certLink').value.trim();
            
            if (!title) {
              this.showNotification('Please enter certificate title', true);
              return;
            }
            
            this.certs.unshift({title, issuer, link});
            this.save(this.KEY_CERTS, this.certs);
            this.clearForm('certForm');
            this.updateGameData();
            this.renderAll();
          });

          // Education
          document.getElementById('eduForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const institute = document.getElementById('eduInstitute').value.trim();
            const degree = document.getElementById('eduDegree').value.trim();
            const year = document.getElementById('eduYear').value.trim();
            
            if (!institute) {
              this.showNotification('Please enter institution name', true);
              return;
            }
            
            this.edu.unshift({institute, degree, year});
            this.save(this.KEY_EDU, this.edu);
            this.clearForm('eduForm');
            this.updateGameData();
            this.renderAll();
          });

          // Social Media
          document.getElementById('socialForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const platform = document.getElementById('socialPlatform').value.trim();
            const link = document.getElementById('socialLink').value.trim();
            
            if (!platform || !link) {
              this.showNotification('Please enter platform and link', true);
              return;
            }
            
            this.social.unshift({platform, link});
            this.save(this.KEY_SOCIAL, this.social);
            this.clearForm('socialForm');
            this.updateGameData();
            this.renderAll();
          });

          // Load sample data
          document.getElementById('loadSample').addEventListener('click', () => {
            this.loadSampleData();
          });
        }
        
        updateGameData() {
          // Calculate XP and update game data
          const gameData = this.gamificationSystem.getGameData(this.currentUser.id);
          const oldLevel = gameData.level;
          
          // Calculate new XP
          gameData.xp = this.gamificationSystem.calculateXP(
            this.profile, this.skills, this.projects, this.certs, 
            this.interns, this.social, this.edu
          );
          
          // Update level
          const currentLevel = this.gamificationSystem.getCurrentLevel(gameData.xp);
          gameData.level = currentLevel.level;
          
          // Update streak
          this.gamificationSystem.updateStreak(gameData);
          
          // Check for new badges
          const newBadges = this.gamificationSystem.checkBadges(
            this.profile, this.skills, this.projects, this.certs, 
            this.interns, this.social, gameData
          );
          
          // Add new badges
          newBadges.forEach(badge => {
            if (!gameData.badges.includes(badge)) {
              gameData.badges.push(badge);
              this.gamificationSystem.showBadgeNotification(badge);
            }
          });
          
          // Check for level up
          if (gameData.level > oldLevel) {
            this.gamificationSystem.showLevelUpNotification(currentLevel);
          }
          
          // Save game data
          this.gamificationSystem.saveGameData(this.currentUser.id, gameData);
          
          // Update snapshot level
          const snapLevel = document.getElementById('snapLevel');
          if (snapLevel) {
            snapLevel.textContent = `Level ${gameData.level} (${currentLevel.name})`;
          }
        }

        setupClearButtons() {
          const clearButtons = [
            { id: 'clearProfile', action: () => this.clearProfile() },
            { id: 'clearSkills', action: () => this.clearData('skills', this.KEY_SKILLS) },
            { id: 'clearProjects', action: () => this.clearData('projects', this.KEY_PROJECTS) },
            { id: 'clearInterns', action: () => this.clearData('interns', this.KEY_INTERNS) },
            { id: 'clearCerts', action: () => this.clearData('certs', this.KEY_CERTS) },
            { id: 'clearEdu', action: () => this.clearData('edu', this.KEY_EDU) },
            { id: 'clearSocial', action: () => this.clearData('social', this.KEY_SOCIAL) }
          ];

          clearButtons.forEach(({id, action}) => {
            document.getElementById(id).addEventListener('click', action);
          });
        }

        clearProfile() {
          if (!confirm('Clear all profile data?')) return;
          this.profile = {
            name: this.currentUser.name || '',
            email: this.currentUser.email || '',
            phone: '',
            bio: '',
            photo: ''
          };
          this.save(this.KEY_PROFILE, this.profile);
          this.updateFormFields();
          this.updateGameData();
          this.renderAll();
        }

        clearData(type, key) {
          if (!confirm(`Clear all ${type}?`)) return;
          this[type] = [];
          this.save(key, this[type]);
          this.updateGameData();
          this.renderAll();
        }

        clearForm(formId) {
          const form = document.getElementById(formId);
          const inputs = form.querySelectorAll('input, textarea');
          inputs.forEach(input => {
            if (input.type !== 'submit' && input.type !== 'button') {
              input.value = '';
            }
          });
        }

        updateFormFields() {
          document.getElementById('name').value = this.profile.name || '';
          document.getElementById('email').value = this.profile.email || '';
          document.getElementById('phone').value = this.profile.phone || '';
          document.getElementById('bio').value = this.profile.bio || '';
          this.updatePhotoPreview();
        }

        updatePhotoPreview() {
          const preview = document.getElementById('photoPreview');
          const placeholder = document.getElementById('photoPlaceholder');
          
          if (this.profile.photo) {
            preview.src = this.profile.photo;
            preview.classList.remove('hidden');
            placeholder.classList.add('hidden');
          } else {
            preview.classList.add('hidden');
            placeholder.classList.remove('hidden');
          }
        }

        setupCustomizeModal() {
          const customizeBtn = document.getElementById('customizeBtn');
          const customizeBackdrop = document.getElementById('customizeBackdrop');
          const closeCustomize = document.getElementById('closeCustomize');
          const applyCustomize = document.getElementById('applyCustomize');

          if (!customizeBtn || !customizeBackdrop || !closeCustomize || !applyCustomize) return;


          customizeBtn.addEventListener('click', () => {
            customizeBackdrop.classList.remove('hidden');
            this.updateCustomizeModal();
          });

          closeCustomize.addEventListener('click', () => {
            customizeBackdrop.classList.add('hidden');
          });

          applyCustomize.addEventListener('click', () => {
            this.applyCustomization();
            customizeBackdrop.classList.add('hidden');
          });
        }

        updateCustomizeModal() {
          document.querySelectorAll('.rs-cb').forEach(cb => {
            cb.checked = this.prefs.sections[cb.dataset.section];
          });
          
          document.querySelectorAll('input[name="theme"]').forEach(radio => {
            radio.checked = radio.value === this.prefs.theme.join('|');
          });
          
          document.querySelectorAll('input[name="template"]').forEach(radio => {
            radio.checked = radio.value === this.prefs.template;
          });
        }

        applyCustomization() {
          document.querySelectorAll('.rs-cb').forEach(cb => {
            this.prefs.sections[cb.dataset.section] = cb.checked;
          });
          
          const selectedTheme = document.querySelector('input[name="theme"]:checked').value.split('|');
          this.prefs.theme = selectedTheme;
          
          this.prefs.template = document.querySelector('input[name="template"]:checked').value;
          
          this.save(this.KEY_PREF, this.prefs);
          this.renderAll();
        }

        setupExportHandlers() {
          const exportBtn = document.getElementById('exportBtn');
          const downloadResume = document.getElementById('downloadResume');
          
          const exportFunction = () => {
            this.renderResumePreview();
            const opt = {
              margin: 0.3,
              filename: `${(this.profile.name || 'resume').replace(/\s+/g, '_')}.pdf`,
              image: { type: 'jpeg', quality: 0.98 },
              html2canvas: { scale: 2, useCORS: true },
              jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
            };
            
            const content = document.querySelector('#resumePreview .resume-page');
            if (content) html2pdf().from(content).set(opt).save();
          };

          if(exportBtn) exportBtn.addEventListener('click', exportFunction);
          if(downloadResume) downloadResume.addEventListener('click', exportFunction);
        }

        loadSampleData() {
          if (!confirm('This will replace your current data with sample data. Continue?')) return;

          const sampleData = {
            profile: {
              name: this.currentUser.name || "John Doe",
              email: this.currentUser.email || "john.doe@example.com",
              phone: "+1 (555) 123-4567",
              bio: "Passionate software developer with expertise in full-stack web development and a strong foundation in modern technologies.",
              photo: ""
            },
            skills: [
              { name: "JavaScript", level: 90 },
              { name: "React", level: 85 },
              { name: "Node.js", level: 80 },
              { name: "Python", level: 75 },
              { name: "HTML/CSS", level: 95 },
              { name: "MongoDB", level: 70 },
              { name: "AWS", level: 60 },
              { name: "Docker", level: 50 }
            ],
            projects: [
              {
                title: "E-commerce Platform",
                link: "https://github.com/johndoe/ecommerce",
                desc: "Full-stack e-commerce application built with React, Node.js, and MongoDB. Features include user authentication, payment processing, and admin dashboard."
              },
              {
                title: "Task Management App",
                link: "https://taskmanager-demo.com",
                desc: "Responsive web application for team collaboration and task tracking. Built with React and Firebase, featuring real-time updates and drag-and-drop functionality."
              },
              {
                title: "Weather Dashboard",
                link: "",
                desc: "Interactive weather application with location-based forecasts, built using vanilla JavaScript and OpenWeather API."
              }
            ],
            internships: [
              {
                company: "Tech Solutions Inc.",
                role: "Software Developer Intern",
                duration: "Jun 2023 ‚Äì Aug 2023",
                desc: "Developed and maintained features for the company's flagship product. Collaborated with senior developers on code reviews and participated in agile development processes."
              },
              {
                company: "StartupXYZ",
                role: "Frontend Developer Intern",
                duration: "Jan 2023 ‚Äì May 2023",
                desc: "Built responsive user interfaces using React and implemented modern design systems. Improved application performance by 30% through code optimization."
              }
            ],
            certificates: [
              { title: "React Developer Certification", issuer: "Meta", link: "https://coursera.org/cert/react123" },
              { title: "AWS Cloud Practitioner", issuer: "Amazon Web Services", link: "" },
              { title: "JavaScript Algorithms and Data Structures", issuer: "freeCodeCamp", link: "https://freecodecamp.org/cert/js456" },
              { title: "Full Stack Web Development", issuer: "Udemy", link: "" }
            ],
            education: [
              { institute: "State University", degree: "B.Sc. Computer Science", year: "2020-2024" },
              { institute: "Community College", degree: "Associate in Computer Programming", year: "2018-2020" }
            ],
            social: [
              { platform: "LinkedIn", link: "https://linkedin.com/in/johndoe" },
              { platform: "GitHub", link: "https://github.com/johndoe" },
              { platform: "Portfolio", link: "https://johndoe.dev" },
              { platform: "LeetCode", link: "https://leetcode.com/johndoe" }
            ]
          };

          this.profile = sampleData.profile;
          this.skills = sampleData.skills;
          this.projects = sampleData.projects;
          this.interns = sampleData.internships;
          this.certs = sampleData.certificates;
          this.edu = sampleData.education;
          this.social = sampleData.social;

          // Save all data
          this.save(this.KEY_PROFILE, this.profile);
          this.save(this.KEY_SKILLS, this.skills);
          this.save(this.KEY_PROJECTS, this.projects);
          this.save(this.KEY_INTERNS, this.interns);
          this.save(this.KEY_CERTS, this.certs);
          this.save(this.KEY_EDU, this.edu);
          this.save(this.KEY_SOCIAL, this.social);

          this.updateFormFields();
          this.updateGameData();
          this.renderAll();
          this.showNotification('Sample data loaded successfully!');
          this.navigate('home');
        }

        renderAll() {
          this.renderDashboard();
          this.renderLists();
          this.renderResumePreview();
          this.renderRecentAchievements();
        }
        
        renderRecentAchievements() {
          const container = document.getElementById('recentAchievements');
          if (!container) return;
          
          const gameData = this.gamificationSystem.getGameData(this.currentUser.id);
          const recentBadges = gameData.badges.slice(-3);
          
          if (recentBadges.length === 0) {
            container.innerHTML = '<p class="text-gray-500 text-center col-span-3">Complete your profile to start earning achievements!</p>';
            return;
          }
          
          container.innerHTML = recentBadges.map(badgeId => {
            const badge = this.gamificationSystem.badges[badgeId];
            return `
              <div class="bg-gradient-to-br from-yellow-50 to-orange-50 p-4 rounded-lg border border-yellow-200 text-center hover:scale-105 transition-transform duration-200">
                <div class="text-3xl mb-2">${badge.icon}</div>
                <h4 class="font-semibold text-sm text-gray-800">${badge.name}</h4>
                <p class="text-xs text-gray-600 mt-1">${badge.description}</p>
              </div>
            `;
          }).join('');
        }
        
        // ‚≠ê NEW METHOD: Calculate Profile Completion
        calculateProfileCompletion() {
            const fields = [
                this.profile.name, 
                this.profile.email, 
                this.profile.bio, 
                this.profile.photo,
                this.skills.length > 0, 
                this.projects.length > 0, 
                this.interns.length > 0, 
                this.certs.length > 0,
                this.edu.length > 0,
                this.social.length > 0
            ];
            
            const totalFields = fields.length;
            const completedFields = fields.filter(Boolean).length;
            
            return Math.round((completedFields / totalFields) * 100);
        }
        // ‚≠ê END NEW METHOD

        renderDashboard() {
          // Update game stats
          const gameData = this.gamificationSystem.getGameData(this.currentUser.id);
          const currentLevel = this.gamificationSystem.getCurrentLevel(gameData.xp);
          const nextLevel = this.gamificationSystem.getNextLevel(currentLevel);
          
          // Render game stats in welcome section
          this.gamificationSystem.renderGameStats('gameStatsContainer', gameData, currentLevel, nextLevel);
          
          // Update counts
          document.getElementById('projectCount').textContent = this.projects.length;
          document.getElementById('skillCount').textContent = this.skills.length;
          document.getElementById('certCount').textContent = this.certs.length;

          // Update snapshot
          document.getElementById('snapName').textContent = this.profile.name || '‚Äî';
          document.getElementById('snapLevel').textContent = `Level ${gameData.level} (${currentLevel.name})`;
          document.getElementById('snapProjCount').textContent = this.projects.length;
          document.getElementById('snapSkill').textContent = (this.skills[0] && this.skills[0].name) || '‚Äî';

          // Update snapshot photo
          const snapPhoto = document.getElementById('snapPhoto');
          if (snapPhoto) {
              if (this.profile.photo) {
                snapPhoto.src = this.profile.photo;
                snapPhoto.classList.remove('hidden');
              } else {
                snapPhoto.classList.add('hidden');
              }
          }

          // Render recent projects
          const projectList = document.getElementById('projectList');
          if (projectList) {
              projectList.innerHTML = '';
              this.projects.slice(-5).reverse().forEach(p => {
                const li = document.createElement('li');
                li.className = 'border-b last:border-0 border-gray-100 py-2 flex items-center gap-2';
                li.innerHTML = `
                  <i class="fas fa-folder text-indigo-500 text-xs"></i>
                  <span class="text-sm">${p.title}</span>
                `;
                projectList.appendChild(li);
              });
          }

          // Render top skills
          const skillsContainer = document.getElementById('skillsContainer');
          if (skillsContainer) {
              skillsContainer.innerHTML = '';
              this.skills.slice(0, 6).forEach(s => {
                const pill = document.createElement('div');
                pill.className = 'flex items-center p-3 rounded-xl bg-gray-50 shadow-sm';
                pill.innerHTML = `
                  <div class="font-semibold flex-1 text-sm">${s.name}</div>
                  <div class="skill-progress-bar h-2 bg-gray-200 rounded-full w-24 ml-4">
                    <div style="width: ${s.level || 70}%" class="h-full rounded-full"></div>
                  </div>
                `;
                skillsContainer.appendChild(pill);
              });
          }

          // Render certificates
          const certContainer = document.getElementById('certContainer');
          if (certContainer) {
              certContainer.innerHTML = '';
              this.certs.slice(0, 6).forEach(c => {
                const div = document.createElement('div');
                div.className = 'p-3 bg-gray-50 rounded-lg shadow-sm';
                div.innerHTML = `
                  <div class="flex items-start gap-2">
                    <i class="fas fa-certificate text-emerald-500 text-xs mt-1"></i>
                    <div>
                      <strong class="text-sm block">${c.title}</strong>
                      <p class="text-xs text-slate-500">${c.issuer || ''}</p>
                    </div>
                  </div>
                `;
                certContainer.appendChild(div);
              });
          }
          
          // =========================================================
          //  ‚≠ê STATUS CARD UPDATES
          // =========================================================

          // 1. Profile Completion
          const completion = this.calculateProfileCompletion();
          document.getElementById('profileCompletionScore').textContent = `${completion}%`;
          
          // 2. ATS Score (Loads from this.atsPersistence, which comes from Local Storage)
          const atsScoreDisplayEl = document.getElementById('atsScoreDisplay');
          // Use persistent score if available, fallback to in-memory cache, then default '‚Äî'
          const finalAtsScore = this.atsPersistence ? this.atsPersistence.score : (this.lastAnalyzedResult ? this.lastAnalyzedResult.score : '‚Äî'); 
          
          atsScoreDisplayEl.textContent = `${finalAtsScore}%`;
          
          // Update ATS Score color (Refined to only change color classes)
          const statusATSScoreEl = document.getElementById('statusATSScore');
          // Start with base classes
          statusATSScoreEl.classList.remove('bg-red-600', 'bg-yellow-600', 'bg-green-600'); 
          
          if (finalAtsScore !== '‚Äî') {
              const score = parseInt(finalAtsScore);
              if (score >= 80) {
                  statusATSScoreEl.classList.add('bg-green-600');
              } else if (score >= 60) {
                  statusATSScoreEl.classList.add('bg-yellow-600');
              } else {
                  statusATSScoreEl.classList.add('bg-red-600');
              }
          } else {
              // Default color when score is not set
              statusATSScoreEl.classList.add('bg-red-600'); 
          }


          // 3. Career Plan Goal
          const savedTargetRole = localStorage.getItem('cn_career_target_role');
          const careerGoalDisplayEl = document.getElementById('careerGoalDisplay');
          const statusCareerPlanEl = document.getElementById('statusCareerPlan');
          
          // Clear current classes before applying new ones
          statusCareerPlanEl.classList.remove('bg-purple-600', 'bg-indigo-600');
          
          if (savedTargetRole) {
              // Truncate long goals to fit nicely
              careerGoalDisplayEl.textContent = savedTargetRole;
              careerGoalDisplayEl.classList.remove('text-4xl');
              careerGoalDisplayEl.classList.add('text-lg'); 
              statusCareerPlanEl.classList.add('bg-indigo-600');
          } else {
              careerGoalDisplayEl.textContent = 'No Goal Set';
              careerGoalDisplayEl.classList.remove('text-lg');
              careerGoalDisplayEl.classList.add('text-4xl');
              statusCareerPlanEl.classList.add('bg-purple-600');
          }
          
          // =========================================================
        }

        renderLists() {
          const itemClasses = 'bg-white p-4 rounded-lg shadow-sm flex flex-col gap-2 relative border border-gray-100 hover:shadow-md transition-all duration-200 hover:scale-105';
          const deleteButton = (cb) => `<button type="button" class="absolute top-2 right-2 text-sm text-red-500 hover:text-red-700 transition-colors p-1 rounded hover:bg-red-50" onclick="${cb}" title="Delete"><i class="fas fa-trash text-xs"></i></button>`;

          // Projects
          const projectsList = document.getElementById('projectsList');
          if (projectsList) {
              projectsList.innerHTML = '';
              this.projects.slice().reverse().forEach((p, idx) => {
                const node = document.createElement('div');
                node.className = itemClasses;
                node.innerHTML = `
                  <div>
                    <div class="flex items-start gap-2 mb-2">
                      <i class="fas fa-folder-open text-indigo-500 mt-1"></i>
                      <strong class="text-base">${p.title}</strong>
                    </div>
                    <p class="text-sm text-slate-600 mb-2">${p.desc || ''}</p>
                    ${p.link ? `<a href="${p.link}" target="_blank" class="text-sm text-blue-500 hover:underline flex items-center gap-1"><i class="fas fa-external-link-alt text-xs"></i>${p.link}</a>` : ''}
                  </div>
                  ${deleteButton(`dashboard.handleDelete('projects', ${this.projects.length - 1 - idx})`)}
                `;
                projectsList.appendChild(node);
              });
          }

          // Skills
          const skillsList = document.getElementById('skillsList');
          if (skillsList) {
              skillsList.innerHTML = '';
              this.skills.slice().reverse().forEach((s, idx) => {
                const node = document.createElement('div');
                node.className = itemClasses;
                node.innerHTML = `
                  <div>
                    <div class="flex items-center justify-between mb-2">
                      <div class="flex items-center gap-2">
                        <i class="fas fa-cog text-sky-500"></i>
                        <strong class="text-base">${s.name}</strong>
                      </div>
                      <span class="text-sm font-semibold text-indigo-600">${s.level || 0}%</span>
                    </div>
                    <div class="skill-progress-bar h-2 bg-gray-200 rounded-full">
                      <div style="width: ${s.level || 0}%" class="h-full rounded-full"></div>
                    </div>
                  </div>
                  ${deleteButton(`dashboard.handleDelete('skills', ${this.skills.length - 1 - idx})`)}
                `;
                skillsList.appendChild(node);
              });
          }

          // Continue with other lists...
          this.renderOtherLists(itemClasses, deleteButton);
        }

        renderOtherLists(itemClasses, deleteButton) {
          // Certificates
          const certsList = document.getElementById('certsList');
          if (certsList) {
              certsList.innerHTML = '';
              this.certs.slice().reverse().forEach((c, idx) => {
                const node = document.createElement('div');
                node.className = itemClasses;
                node.innerHTML = `
                  <div>
                    <div class="flex items-start gap-2 mb-2">
                      <i class="fas fa-certificate text-emerald-500 mt-1"></i>
                      <div>
                        <strong class="text-base block">${c.title}</strong>
                        <p class="text-sm text-slate-600">${c.issuer || ''}</p>
                      </div>
                    </div>
                    ${c.link ? `<a href="${c.link}" target="_blank" class="text-sm text-blue-500 hover:underline flex items-center gap-1"><i class="fas fa-external-link-alt text-xs"></i>View Certificate</a>` : ''}
                  </div>
                  ${deleteButton(`dashboard.handleDelete('certs', ${this.certs.length - 1 - idx})`)}
                `;
                certsList.appendChild(node);
              });
          }

          // Education
          const eduList = document.getElementById('eduList');
          if (eduList) {
              eduList.innerHTML = '';
              this.edu.slice().reverse().forEach((e, idx) => {
                const node = document.createElement('div');
                node.className = itemClasses;
                node.innerHTML = `
                  <div>
                    <div class="flex items-start gap-2 mb-2">
                      <i class="fas fa-graduation-cap text-purple-500 mt-1"></i>
                      <div>
                        <strong class="text-base block">${e.institute}</strong>
                        <p class="text-sm text-slate-600">${e.degree || ''} ‚Äî ${e.year || ''}</p>
                      </div>
                    </div>
                  </div>
                  ${deleteButton(`dashboard.handleDelete('edu', ${this.edu.length - 1 - idx})`)}
                `;
                eduList.appendChild(node);
              });
          }

          // Internships
          const internsList = document.getElementById('internsList');
          if (internsList) {
              internsList.innerHTML = '';
              this.interns.slice().reverse().forEach((it, idx) => {
                const node = document.createElement('div');
                node.className = itemClasses;
                node.innerHTML = `
                  <div>
                    <div class="flex items-start gap-2 mb-2">
                      <i class="fas fa-briefcase text-orange-500 mt-1"></i>
                      <div>
                        <strong class="text-base block">${it.company}</strong>
                        <p class="text-sm text-slate-600">${it.role || ''}</p>
                        <p class="text-sm text-slate-500">${it.duration || ''}</p>
                      </div>
                    </div>
                    <p class="text-sm text-slate-600">${it.desc || ''}</p>
                  </div>
                  ${deleteButton(`dashboard.handleDelete('interns', ${this.interns.length - 1 - idx})`)}
                `;
                internsList.appendChild(node);
              });
          }

          // Social Media
          const socialList = document.getElementById('socialList');
          if (socialList) {
              socialList.innerHTML = '';
              this.social.slice().reverse().forEach((s, idx) => {
                const node = document.createElement('div');
                node.className = itemClasses;
                node.innerHTML = `
                  <div>
                    <div class="flex items-start gap-2 mb-2">
                      <i class="fas fa-link text-blue-500 mt-1"></i>
                      <div>
                        <strong class="text-base block">${s.platform}</strong>
                        <a href="${s.link}" target="_blank" class="text-sm text-blue-500 hover:underline flex items-center gap-1">
                          <i class="fas fa-external-link-alt text-xs"></i>${s.link}
                        </a>
                      </div>
                    </div>
                  </div>
                  ${deleteButton(`dashboard.handleDelete('social', ${this.social.length - 1 - idx})`)}
                `;
                socialList.appendChild(node);
              });
          }
        }

        handleDelete(section, index) {
          if (!confirm('Are you sure you want to delete this item?')) return;
          
          switch (section) {
            case 'projects':
              this.projects.splice(index, 1);
              this.save(this.KEY_PROJECTS, this.projects);
              break;
            case 'skills':
              this.skills.splice(index, 1);
              this.save(this.KEY_SKILLS, this.skills);
              break;
            case 'certs':
              this.certs.splice(index, 1);
              this.save(this.KEY_CERTS, this.certs);
              break;
            case 'edu':
              this.edu.splice(index, 1);
              this.save(this.KEY_EDU, this.edu);
              break;
            case 'interns':
              this.interns.splice(index, 1);
              this.save(this.KEY_INTERNS, this.interns);
              break;
            case 'social':
              this.social.splice(index, 1);
              this.save(this.KEY_SOCIAL, this.social);
              break;
          }
          this.updateGameData();
          this.renderAll();
        }

        renderResumePreview() {
          const resumePreview = document.getElementById('resumePreview');
          if (!resumePreview) return;
          
          resumePreview.innerHTML = this.generateResumeHTML(
            this.prefs.sections,
            this.prefs.order,
            this.prefs.theme,
            this.prefs.template
          );

          // Initialize Sortable.js for drag and drop
          const sortableElement = document.getElementById('sortable-resume');
          if (sortableElement) {
            new Sortable(sortableElement, {
              animation: 150,
              onEnd: (evt) => {
                const oldIndex = evt.oldIndex;
                const newIndex = evt.newIndex;
                const item = this.prefs.order.splice(oldIndex, 1)[0];
                this.prefs.order.splice(newIndex, 0, item);
                this.save(this.KEY_PREF, this.prefs);
                this.renderResumePreview();
              }
            });
          }
        }

        generateResumeHTML(selectedSections, order, theme, template) {
          const include = sec => selectedSections[sec];
          const [accent1, accent2] = theme;
          
          // Update CSS variables
          document.documentElement.style.setProperty('--brand-color', accent1);
          document.documentElement.style.setProperty('--brand-dark', accent2);

          const photoHtml = this.profile.photo ? 
            `<div class="w-24 h-24 flex-shrink-0">
              <img src="${this.profile.photo}" alt="Profile Photo" class="w-full h-full object-cover rounded-full shadow-lg border-4 border-white/20">
            </div>` : '';

          // Section templates
          const sectionMap = {
            profile: `<section data-id="profile" class="resume-section p-4 cursor-grab bg-white rounded-lg shadow-md mb-4">
                        <h3 class="resume-h text-lg font-bold uppercase tracking-wide text-indigo-600 pb-2 mb-2">Professional Summary</h3>
                        <div class="resume-item text-sm text-gray-700">${this.profile.bio || 'Add a professional summary to highlight your key qualifications and career objectives.'}</div>
                      </section>`,
            
            skills: `<section data-id="skills" class="resume-section p-4 cursor-grab bg-white rounded-lg shadow-md mb-4">
                      <h3 class="resume-h text-lg font-bold uppercase tracking-wide text-indigo-600 pb-2 mb-2"> Skills</h3>
                      <div class="flex flex-wrap gap-2">
                        ${this.skills.length ? 
                          this.skills.map(s => `<span class='resume-pill text-xs font-semibold px-3 py-1 bg-gray-100 rounded-full border border-gray-200'>${s.name} (${s.level || 0}%)</span>`).join('') : 
                          '<div class="text-sm text-gray-500">No skills added yet</div>'
                        }
                      </div>
                    </section>`,
            
            projects: `<section data-id="projects" class="resume-section p-4 cursor-grab bg-white rounded-lg shadow-md mb-4">
                        <h3 class="resume-h text-lg font-bold uppercase tracking-wide text-indigo-600 pb-2 mb-2">Projects</h3>
                        ${this.projects.length ? 
                          this.projects.map(p => `
                            <div class='resume-item mb-3'>
                              <div class='text-base font-semibold'>${p.title}</div>
                              ${p.link ? `<div class='text-sm text-gray-600 mb-1'><a href="${p.link}" target="_blank" class="text-blue-500 hover:underline">${p.link}</a></div>` : ''}
                              <p class="text-sm text-gray-700">${p.desc || ''}</p>
                            </div>
                          `).join('') : 
                          '<div class="text-sm text-gray-500">No projects added yet</div>'
                        }
                      </section>`,
            
            internships: `<section data-id="internships" class="resume-section p-4 cursor-grab bg-white rounded-lg shadow-md mb-4">
                          <h3 class="resume-h text-lg font-bold uppercase tracking-wide text-indigo-600 pb-2 mb-2">Work Experience</h3>
                          ${this.interns.length ? 
                            this.interns.map(it => `
                              <div class='resume-item mb-3'>
                                <div class='text-base font-semibold'>${it.company} ‚Äî ${it.role || ''}</div>
                                <div class='text-sm text-gray-600 mb-1'>${it.duration || ''}</div>
                                <p class="text-sm text-gray-700">${it.desc || ''}</p>
                              </div>
                            `).join('') : 
                            '<div class="text-sm text-gray-500">No work experience added yet</div>'
                          }
                        </section>`,
            
            certificates: `<section data-id="certificates" class="resume-section p-4 cursor-grab bg-white rounded-lg shadow-md mb-4">
                          <h3 class="resume-h text-lg font-bold uppercase tracking-wide text-indigo-600 pb-2 mb-2">Certifications & Awards</h3>
                          <div>
                            ${this.certs.length ? 
                              this.certs.map(c => `
                                <div class='resume-item mb-2'>
                                  <strong class="text-sm">${c.title}</strong>
                                  <span class='text-xs text-gray-500'>${c.issuer ? ` ‚Ä¢ ${c.issuer}` : ''}</span>
                                </div>
                              `).join('') : 
                              '<div class="text-sm text-gray-500">No certifications added yet</div>'
                            }
                          </div>
                        </section>`,
            
            education: `<section data-id="education" class="resume-section p-4 cursor-grab bg-white rounded-lg shadow-md mb-4">
                        <h3 class="resume-h text-lg font-bold uppercase tracking-wide text-indigo-600 pb-2 mb-2">Education</h3>
                        ${this.edu.length ? 
                          this.edu.map(e => `
                            <div class='resume-item mb-2'>
                              <strong class="text-base">${e.institute}</strong>
                              <p class="text-sm text-gray-600">${e.degree || ''} ‚Äî ${e.year || ''}</p>
                            </div>
                          `).join('') : 
                          '<div class="text-sm text-gray-500">No education added yet</div>'
                        }
                      </section>`,
            
            social: `<section data-id="social" class="resume-section p-4 cursor-grab bg-white rounded-lg shadow-md mb-4">
                      <h3 class="resume-h text-lg font-bold uppercase tracking-wide text-indigo-600 pb-2 mb-2">Links & Profiles</h3>
                      <div>
                        ${this.social.length ? 
                          this.social.map(s => `
                            <div class='resume-item text-sm mb-1'>
                              <a href="${s.link}" target="_blank" class="text-blue-500 hover:underline">${s.platform}: ${s.link}</a>
                            </div>
                          `).join('') : 
                          '<div class="text-sm text-gray-500">No social links added yet</div>'
                        }
                      </div>
                    </section>`
          };

          const filteredSections = order.filter(sec => include(sec)).map(sec => sectionMap[sec]).join('');

          if (template === 'modern') {
            return `
              <div class="resume-page p-8 bg-white rounded-xl shadow-lg">
                <header class="pb-6 mb-6 border-b border-gray-300">
                  <h1 class="text-4xl font-extrabold brand-title text-indigo-800">${this.profile.name || 'Your Name'}</h1>
                  <p class="text-lg text-slate-600 mt-1">${this.profile.bio || ''}</p>
                  <div class="text-sm text-slate-600 mt-2 flex flex-wrap gap-4">
                    ${this.profile.email ? `<p class="flex items-center gap-1"><i class="fas fa-envelope text-indigo-600"></i> ${this.profile.email}</p>` : ''}
                    ${this.profile.phone ? `<p class="flex items-center gap-1"><i class="fas fa-phone text-indigo-600"></i> ${this.profile.phone}</p>` : ''}
                    ${this.social.length ? this.social.map(s => `<a href="${s.link}" target="_blank" class="flex items-center gap-1 text-blue-500 hover:underline"><i class="fas fa-link text-indigo-600"></i> ${s.platform}</a>`).join('') : ''}
                  </div>
                </header>
                <div id="sortable-resume" class="space-y-6">
                  ${filteredSections}
                </div>
              </div>
            `;
          }
          
          // Classic template
          return `
            <div class="resume-page p-6 bg-white rounded-xl shadow-lg">
              <header class="flex flex-col md:flex-row md:items-start justify-between pb-4 mb-6 gap-4 border-b-4 border-indigo-600">
                <div class="flex-1">
                  <h1 class="text-4xl font-extrabold brand-title text-indigo-800">${this.profile.name || 'Your Name'}</h1>
                  <p class="text-lg text-slate-600 mt-1">${this.profile.bio || ''}</p>
                  <div class="text-sm text-slate-600 mt-4">
                    ${this.profile.email ? `<p class="mb-1 flex items-center gap-2"><i class="fas fa-envelope text-indigo-600"></i> ${this.profile.email}</p>` : ''}
                    ${this.profile.phone ? `<p class="flex items-center gap-2"><i class="fas fa-phone text-indigo-600"></i> ${this.profile.phone}</p>` : ''}
                  </div>
                </div>
                ${photoHtml}
              </header>
              <div id="sortable-resume" class="space-y-4">
                ${filteredSections}
              </div>
            </div>
          `;
        }

        showNotification(message, isError = false) {
          const notification = document.createElement('div');
          notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white z-50 transform translate-x-full transition-all duration-300 ${isError ? 'bg-red-500' : 'bg-green-500'}`;
          notification.innerHTML = `
            <i class="fas ${isError ? 'fa-exclamation-circle' : 'fa-check-circle'} mr-2"></i>
            ${message}
          `;
          
          document.body.appendChild(notification);
          
          // Animate in
          setTimeout(() => {
            notification.style.transform = 'translateX(0)';
          }, 100);
          
          setTimeout(() => {
            notification.style.transform = 'translateX(100%)';
            setTimeout(() => {
            notification.remove();
            }, 300);
          }, 4000);
        }
        
        // --- NEW FEATURE IMPLEMENTATIONS (Simulated) ---
        
        // --- PART 1: AI CAREER COACH IMPLEMENTATION ---
        handleGenerateRoadmap(e) {
           // Add this new event listener and handler somewhere in the global scope of your script (e.g., after the class definitions)

document.getElementById("coachForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const btn = document.getElementById('generateRoadmapBtn');
  const output = document.getElementById("roadmapOutput");
  
  // ‚≠ê NEW: Get and Save Target Role before API call
  const targetRole = document.getElementById("targetRole").value;
  localStorage.setItem('cn_career_target_role', targetRole); 
  window.dashboard.renderDashboard(); // Update home screen status cards instantly
  // ‚≠ê END NEW

  btn.disabled = true;
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating Roadmap...';
  output.innerHTML = `<div class="text-indigo-600 font-semibold p-4">Analyzing profile and plotting personalized roadmap...</div>`;


  const payload = {
    currentRole: document.getElementById("currentRole").value,
    targetRole: targetRole, // Use targetRole variable
    experienceYears: document.getElementById("experienceYears").value,
    currentSkills: document.getElementById("coachSkills").value,
    careerGoals: document.getElementById("careerGoals").value,
    timeline: document.getElementById("timeline").value
  };

  try {
    const res = await fetch("https://careernest-backend-jbk3.onrender.com/api/career-coach", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    if (!res.ok) {
        const errorBody = await res.json().catch(() => ({ error: "Server responded with an error." }));
        throw new Error(`API failed: ${errorBody.error}`);
    }

    const data = await res.json();
    window.dashboard.showNotification('Roadmap generated successfully!');

    output.innerHTML = `
      <div class="bg-indigo-100 border border-indigo-300 p-4 rounded-lg shadow-sm">
        <h4 class="font-bold text-lg text-indigo-800 mb-2">Career Direction Summary</h4>
        <p class="text-slate-700">${data.summary}</p>
      </div>
      
      <div class="mt-6">
        <h3 class="text-xl font-bold text-indigo-700 mb-3 border-b pb-1"><i class="fas fa-route mr-2"></i>Personalized Roadmap</h3>
        ${data.roadmap.map(p => `
          <div class="mt-3 p-4 border-l-4 border-indigo-400 bg-indigo-50 rounded-lg shadow-sm">
            <h4 class="text-lg font-bold text-indigo-800">${p.phase}</h4>
            <p class="text-xs text-slate-600 mb-2">Duration: ${p.duration}</p>
            <div class="font-semibold text-sm text-slate-700 mt-2">Key Focus: ${p.focus.join(", ")}</div>
            <ul class="list-disc list-inside text-sm text-slate-700 pl-4 mt-2">
              ${p.actions.map(a => `<li>${a}</li>`).join("")}
            </ul>
          </div>
        `).join("")}
      </div>
      
      <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
            <h3 class="text-xl font-bold text-indigo-700 mb-3 border-b pb-1"><i class="fas fa-exclamation-triangle mr-2"></i>Identified Skill Gaps</h3>
            <div class="flex flex-wrap gap-2">
                ${data.skill_gaps.map(s => `<span class="bg-red-100 text-red-700 text-sm font-semibold px-3 py-1 rounded-full">${s}</span>`).join("")}
            </div>
            <h3 class="text-xl font-bold text-indigo-700 mb-3 border-b pb-1 mt-6"><i class="fas fa-medal mr-2"></i>Certifications</h3>
            <ul class="list-disc list-inside text-sm text-slate-700">
              ${data.certifications.map(c => `<li>${c}</li>`).join("")}
            </ul>
        </div>
        
        <div>
            <h3 class="text-xl font-bold text-indigo-700 mb-3 border-b pb-1"><i class="fas fa-lightbulb mr-2"></i>Recommended Projects</h3>
            <ul class="list-disc list-inside text-sm text-slate-700">
              ${data.project_ideas.map(p => `<li>${p}</li>`).join("")}
            </ul>
            <h3 class="text-xl font-bold text-indigo-700 mb-3 border-b pb-1 mt-6"><i class="fas fa-calendar-alt mr-2"></i>Daily Practice Plan</h3>
            <ul class="list-disc list-inside text-sm text-slate-700">
              ${data.daily_plan.map(d => `<li>${d}</li>`).join("")}
            </ul>
        </div>
      </div>
    `;
  } catch (err) {
    output.innerHTML = `<div class="text-red-600 p-4 bg-red-50 border border-red-200 rounded-lg"><i class="fas fa-exclamation-circle mr-2"></i>Failed to generate roadmap: ${err.message}</div>`;
    window.dashboard.showNotification(`Error: ${err.message}`, true);
  } finally {
      btn.disabled = false;
      btn.innerHTML = '<i class="fas fa-route"></i> Generate Personalized Roadmap';
  }
});

// REMEMBER to remove the old, simulated handleGenerateRoadmap function if it's still present in your file. // Increased timeout for a more "AI generation" feel
        }
        
        // --- PART 2: RESUME SCORER IMPLEMENTATION ---
        handleResumeFileChange() {
            const uploadInput = document.getElementById('resumeUpload');
            const fileDisplay = document.getElementById('fileNameDisplay');
            const scoreBtn = document.getElementById('scoreResumeBtn');
            
            if (uploadInput.files.length > 0) {
                fileDisplay.textContent = uploadInput.files[0].name;
                scoreBtn.disabled = false;
            } else {
                fileDisplay.textContent = 'No file selected';
                scoreBtn.disabled = true;
            }
            document.getElementById('scorerResults').classList.add('hidden');

            // --- NEW: Clear cache when file selection changes ---
            this.lastAnalyzedFile = null;
            this.lastAnalyzedResult = null;
            
            // ‚≠ê ADD THIS: Clear persistent score as well when a new file is uploaded
            this.atsPersistence = null;
            this.save(this.KEY_ATS_SCORE, null); 
            // ----------------------------------------------------
            
            this.renderDashboard(); // ‚≠ê NEW: Re-render dashboard to clear ATS score
        }

     async handleScoreResume() { // NOTE: Must be async
            const btn = document.getElementById('scoreResumeBtn');
            const results = document.getElementById('scorerResults');
            const file = document.getElementById('resumeUpload').files[0];
            const atsScoreEl = document.getElementById('atsScore');
            const improvementSummaryEl = document.getElementById('improvementSummary');
            const detailedAnalysisListEl = document.getElementById('detailedAnalysisList');
            const keywordsFoundEl = document.getElementById('keywordsFound');
            const keywordsMissingEl = document.getElementById('keywordsMissing');
            const atsCategoryEl = document.getElementById('atsCategory'); 

            if (!file) {
                this.showNotification("Please upload a resume file first.", true);
                return;
                
            }

            // --- CACHE CHECK: If file name is the same and result exists, use cache ---
            if (this.lastAnalyzedFile === file.name && this.lastAnalyzedResult) {
                this.showNotification("Showing cached analysis for this resume.", false);
                // Render the cached result immediately
                this.renderScorerResults(this.lastAnalyzedResult);
                
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-check-circle"></i> Analyze & Get ATS Score';
                return; // STOP execution
            }
            // --------------------------------------------------------------------------

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing Resume...';
            results.classList.add('hidden');

            try {
                const resumeText = await extractResumeText(file); 
                const result = await analyzeResume(resumeText); 
                
                // --- CACHE STORAGE: Store the result and file name ---
                this.lastAnalyzedFile = file.name;
                this.lastAnalyzedResult = result;
                
                // ‚≠ê ADD THIS: Store result to Local Storage for persistence
                this.atsPersistence = { 
                    score: result.score, 
                    summary: result.summary,
                    // Optionally save file name to track which resume was scored
                    file: file.name 
                };
                this.save(this.KEY_ATS_SCORE, this.atsPersistence);
                // ------------------------------------------------------
                
                this.renderScorerResults(result); // Call a new helper function
                
                this.showNotification(`Resume scored: ${result.score}%`, result.score < 80);
                this.renderDashboard(); // ‚≠ê NEW: Re-render dashboard to update ATS score card instantly

            } catch (err) {
                // Clear cache on failure so a retry runs the AI again
                this.lastAnalyzedFile = null;
                this.lastAnalyzedResult = null;
                this.renderDashboard(); // ‚≠ê NEW: Re-render dashboard to update ATS score card on error

                console.error("Groq/Extraction Error:", err);
                this.showNotification(`Resume analysis failed: ${err.message}`, true);
            }

            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-check-circle"></i> Analyze & Get ATS Score';
        }
        // --- NEW: Helper function to render the results on the UI ---
        renderScorerResults(result) {
            const results = document.getElementById('scorerResults');
            const atsScoreEl = document.getElementById('atsScore');
            const improvementSummaryEl = document.getElementById('improvementSummary');
            const detailedAnalysisListEl = document.getElementById('detailedAnalysisList');
            const keywordsFoundEl = document.getElementById('keywordsFound');
            const keywordsMissingEl = document.getElementById('keywordsMissing');
            const atsCategoryEl = document.getElementById('atsCategory'); 

            results.classList.remove('hidden');

            const finalScore = result.score;
            // Assuming category mapping logic is handled based on score or provided by AI
            // We'll calculate a simple category here based on score
            let finalCategory = 'Weak';
            if (finalScore >= 80) finalCategory = 'Strong';
            else if (finalScore >= 60) finalCategory = 'Average';
            else finalCategory = 'Weak';


            // Update ATS Score and color (using the logic you already set up)
            atsScoreEl.textContent = `${finalScore}%`;
            
            let colorClass = 'bg-gray-500';
            if (finalCategory === 'Strong') {
                colorClass = 'bg-green-600';
            } else if (finalCategory === 'Average') {
                colorClass = 'bg-yellow-600';
            } else if (finalCategory === 'Weak') {
                colorClass = 'bg-red-600';
            }

            atsCategoryEl.textContent = finalCategory;
            atsScoreEl.closest('.p-4').className = `p-4 rounded-xl text-white ${colorClass} text-center`;
            
            // Update Summary
            improvementSummaryEl.textContent = result.summary;
            
            // Detailed Analysis List (Strengths/Suggestions)
            detailedAnalysisListEl.innerHTML = `
                <h4 class="font-bold text-lg mb-3 flex items-center gap-2 text-gray-700"><i class="fas fa-chart-bar"></i> Strengths Identified</h4>
                <ul class="list-disc list-inside space-y-2 text-sm text-slate-600 pl-4">
                    ${result.strengths.map(s => `<li>${s}</li>`).join('')}
                </ul>
                <h4 class="font-bold text-lg mb-3 flex items-center gap-2 text-gray-700"><i class="fas fa-exclamation-triangle"></i> Actionable Suggestions</h4>
                <ul class="list-disc list-inside space-y-2 text-sm text-slate-600 pl-4">
                    ${result.suggestions.map(s => `<li>${s}</li>`).join('')}
                </ul>
            `;
            
            // Keyword Check 
            keywordsFoundEl.innerHTML = result.strengths.map(k => `<span class="bg-green-200 text-green-800 text-xs font-semibold px-2 py-1 rounded-full">${k}</span>`).join('');
            keywordsMissingEl.innerHTML = result.missing_keywords.map(k => `<span class="bg-red-200 text-red-800 text-xs font-semibold px-2 py-1 rounded-full">${k}</span>`).join('');
        }

        async handleAnalyzeJd() {
            const btn = document.getElementById('analyzeJdBtn');
            const jdInput = document.getElementById('jdInput').value.trim();
            const matchScoreEl = document.getElementById('matchScore');
            const matchCommentEl = document.getElementById('matchComment');
            const gapAnalysisEl = document.getElementById('gapAnalysis');
            const recsListEl = document.getElementById('recsList');
            
            if (jdInput.length < 50) {
                this.showNotification("Please paste a Job Description (min 50 chars).", true);
                return;
            }
            
            // =========================================================
            //  ‚≠ê CACHE CHECK (New Logic)
            // =========================================================
            if (this.lastAnalyzedJdText === jdInput && this.lastJdMatchResult) {
                this.showNotification("Showing cached match result for this Job Description.", false);
                this.renderJdMatchResults(this.lastJdMatchResult);
                
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-search"></i> Analyze Match';
                return; // STOP execution, use cached data
            }
            // =========================================================

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing Match...';
            matchScoreEl.textContent = '‚Äî%';
            matchScoreEl.closest('.bg-gray-100').className = 'bg-gray-100 p-4 rounded-lg text-center';
            matchCommentEl.textContent = 'Analyzing your profile against the Job Description...';
            gapAnalysisEl.innerHTML = '';
            recsListEl.innerHTML = '';

            // 1. Prepare profile data from current dashboard state
            const profile = {
                name: this.profile.name || "Candidate",
                bio: this.profile.bio,
                skills: this.skills.map(s => s.name),
                projects: this.projects.map(p => ({ title: p.title, desc: p.desc })),
                experience: this.interns.map(i => ({ role: i.role, company: i.company, desc: i.desc })),
                certifications: this.certs.map(c => c.title)
            };

            const payload = {
                profile: profile, 
                jdText: jdInput
            };

            try {
                // 2. Call the backend API (using the structure from the last step)
                const res = await fetch("https://careernest-backend-jbk3.onrender.com/api/jd-match", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });

                if (!res.ok) {
                    const errorBody = await res.json().catch(() => ({ error: "Server responded with an error." }));
                    throw new Error(`API failed: ${errorBody.error}`);
                }

                const data = await res.json();
                
                // =========================================================
                //  ‚≠ê CACHE STORAGE (New Logic)
                // =========================================================
                this.lastAnalyzedJdText = jdInput;
                this.lastJdMatchResult = data;
                // =========================================================

                this.renderJdMatchResults(data); 
                
                this.showNotification(`JD Match Score: ${data.match_score}%`, data.match_score < 75);

            } catch (err) {
                console.error("JD Match Error:", err);
                matchCommentEl.textContent = `JD analysis failed: ${err.message}. Ensure the /api/jd-match endpoint is running on your server.`;
                this.showNotification(`JD Match analysis failed: ${err.message}`, true);
                
                // Reset cache on failure
                this.lastAnalyzedJdText = null;
                this.lastJdMatchResult = null;
                
                // Reset score state on failure
                matchScoreEl.textContent = '‚Äî%';
                matchScoreEl.closest('.p-4').className = 'bg-gray-100 p-4 rounded-lg text-center';
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-search"></i> Analyze Match';
            }
        }
        
        // =========================================================
        //  ‚≠ê NEW HELPER: renderJdMatchResults (To avoid code duplication)
        // =========================================================
        renderJdMatchResults(data) {
            const matchScoreEl = document.getElementById('matchScore');
            const matchCommentEl = document.getElementById('matchComment');
            const gapAnalysisEl = document.getElementById('gapAnalysis');
            const recsListEl = document.getElementById('recsList');
            
            const finalScore = data.match_score;
            const matchContainer = matchScoreEl.closest('.p-4');

            matchScoreEl.textContent = `${finalScore}%`;
            matchContainer.className = `p-4 rounded-lg text-center ${finalScore >= 75 ? 'bg-green-100' : finalScore >= 50 ? 'bg-yellow-100' : 'bg-red-100'}`;
            matchCommentEl.textContent = data.verdict;

            // Render Matched/Missing Skills
            gapAnalysisEl.innerHTML = `
                <h4 class="font-bold text-md text-green-700">Matched Skills (${data.matched_skills.length})</h4>
                <div class="flex flex-wrap gap-2">
                    ${data.matched_skills.map(d => `<span class="bg-green-200 text-green-800 text-xs font-semibold px-2 py-1 rounded-full"><i class="fas fa-check"></i> ${d}</span>`).join('')}
                </div>
                <h4 class="font-bold text-md text-red-700 mt-3">Skill Gaps (${data.missing_skills.length})</h4>
                <div class="flex flex-wrap gap-2">
                    ${data.missing_skills.map(d => `<span class="bg-red-200 text-red-800 text-xs font-semibold px-2 py-1 rounded-full"><i class="fas fa-times"></i> ${d}</span>`).join('')}
                </div>
            `;

            // Render Recommendations
            recsListEl.innerHTML = data.recommendations.map(r => `<li>${r}</li>`).join('');
        }
      }

      // Final initialization logic
      document.addEventListener('DOMContentLoaded', function() {
          const navLinks = document.querySelectorAll('.nav-link');
          const sections = document.querySelectorAll('.page section');

          function navigate(targetId) {
              sections.forEach(section => {
                  section.classList.add('hidden');
              });
              const targetSection = document.getElementById(targetId);
              if (targetSection) {
                  targetSection.classList.remove('hidden');
              }

              navLinks.forEach(link => {
                  link.classList.remove('active');
              });
              const targetLink = document.querySelector(`.nav-link[data-target="${targetId}"]`);
              if (targetLink) {
                  targetLink.classList.add('active');
              }
          }

          navLinks.forEach(link => {
              link.addEventListener('click', (e) => {
                  e.preventDefault();
                  const target = link.dataset.target;
                  // The dashboard.navigate handles the rendering now
                  if (window.dashboard) {
                      window.dashboard.navigate(target);
                  } else {
                       navigate(target); // Fallback if dashboard isn't initialized yet
                  }
              });
          });

          // Quick action navigation listeners (Ensure they use window.navigate, which calls dashboard.navigate)
          const quickActionButtons = document.querySelectorAll('.bg-white\\/10 button[onclick]');
          quickActionButtons.forEach(button => {
              const target = button.getAttribute('onclick').match(/navigate\('(.+?)'\)/);
              if (target && target[1]) {
                  button.addEventListener('click', (e) => {
                      e.preventDefault();
                      if (window.dashboard) {
                          window.dashboard.navigate(target[1]);
                      } else {
                           navigate(target[1]);
                      }
                  });
                  // Remove the inline onclick for clean separation
                  button.removeAttribute('onclick');
              }
          });
          
          document.getElementById('loadSample').addEventListener('click', (e) => {
              e.preventDefault();
              window.dashboard.loadSampleData();
          });
          document.querySelector('button[onclick="navigate(\'analytics\')"]').addEventListener('click', (e) => {
              e.preventDefault();
              window.dashboard.navigate('analytics');
          });


          // --- Career Nest Link Generator Logic ---
          const generateLinkBtn = document.getElementById('generateLinkBtn');
          const copyLinkBtn = document.getElementById('copyLinkBtn');
          const careerNestLinkInput = document.getElementById('careerNestLink');
          const linkStatus = document.getElementById('linkStatus');

         function generateCareerNestLink() {
    const HOSTED_BASE_URL = "https://career-nest-pro.vercel.app/"; 

    const userName = (typeof dashboard !== 'undefined' && dashboard.profile.name) || 
                                    document.getElementById('name')?.value || 
                                    'user';
    const safeName = userName.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '');
    const userId = Math.random().toString(36).substring(2, 8); 

    const shareableLink = `${HOSTED_BASE_URL}/#p/${safeName}-${userId}`;
    
    careerNestLinkInput.value = shareableLink;
    careerNestLinkInput.placeholder = shareableLink;
    generateLinkBtn.classList.add('hidden');
    copyLinkBtn.classList.remove('hidden');
    
    linkStatus.textContent = `Your shareable profile link is ready!`; 
    
    setTimeout(copyCareerNestLink, 100);
}

          function copyCareerNestLink() {
              careerNestLinkInput.select();
              careerNestLinkInput.setSelectionRange(0, 99999); 

              navigator.clipboard.writeText(careerNestLinkInput.value).then(() => {
                  linkStatus.textContent = 'Link copied to clipboard! Share it proudly.';
                  copyLinkBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                  
                  setTimeout(() => {
                      copyLinkBtn.innerHTML = '<i class="fas fa-copy"></i> Copy Link';
                      linkStatus.textContent = 'Your shareable profile link is ready!';
                  }, 2000);
              }).catch(err => {
                  console.error('Failed to copy text: ', err);
                  linkStatus.textContent = 'Failed to copy link. Please copy it manually.';
              });
          }

          if (generateLinkBtn) {
              generateLinkBtn.addEventListener('click', generateCareerNestLink);
          }

          if (copyLinkBtn) {
              copyLinkBtn.addEventListener('click', copyCareerNestLink);
          }
          // --- End Career Nest Link Generator Logic ---

          // Initialize dashboard
          const dashboard = new CareerNestDashboard();

          // Make navigate function global for button clicks
          window.navigate = (pageId) => dashboard.navigate(pageId);
          window.dashboard = dashboard; // Make global for direct calls like handleDelete

          // Initialize page based on URL hash
          const initialHash = window.location.hash.substring(1) || 'home';
          dashboard.navigate(initialHash);
      });
    </script>
</body>
</html>
